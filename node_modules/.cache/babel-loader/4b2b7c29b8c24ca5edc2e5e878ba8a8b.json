{"ast":null,"code":"import { __extends } from \"tslib\";\nimport { isFunction } from './util/isFunction';\nimport { isSubscription, Subscription } from './Subscription';\nimport { config } from './config';\nimport { reportUnhandledError } from './util/reportUnhandledError';\nimport { noop } from './util/noop';\nimport { nextNotification, errorNotification, COMPLETE_NOTIFICATION } from './NotificationFactories';\nimport { timeoutProvider } from './scheduler/timeoutProvider';\nimport { captureError } from './util/errorContext';\nvar Subscriber = function (_super) {\n  __extends(Subscriber, _super);\n  function Subscriber(destination) {\n    var _this = _super.call(this) || this;\n    _this.isStopped = false;\n    if (destination) {\n      _this.destination = destination;\n      if (isSubscription(destination)) {\n        destination.add(_this);\n      }\n    } else {\n      _this.destination = EMPTY_OBSERVER;\n    }\n    return _this;\n  }\n  Subscriber.create = function (next, error, complete) {\n    return new SafeSubscriber(next, error, complete);\n  };\n  Subscriber.prototype.next = function (value) {\n    if (this.isStopped) {\n      handleStoppedNotification(nextNotification(value), this);\n    } else {\n      this._next(value);\n    }\n  };\n  Subscriber.prototype.error = function (err) {\n    if (this.isStopped) {\n      handleStoppedNotification(errorNotification(err), this);\n    } else {\n      this.isStopped = true;\n      this._error(err);\n    }\n  };\n  Subscriber.prototype.complete = function () {\n    if (this.isStopped) {\n      handleStoppedNotification(COMPLETE_NOTIFICATION, this);\n    } else {\n      this.isStopped = true;\n      this._complete();\n    }\n  };\n  Subscriber.prototype.unsubscribe = function () {\n    if (!this.closed) {\n      this.isStopped = true;\n      _super.prototype.unsubscribe.call(this);\n      this.destination = null;\n    }\n  };\n  Subscriber.prototype._next = function (value) {\n    this.destination.next(value);\n  };\n  Subscriber.prototype._error = function (err) {\n    try {\n      this.destination.error(err);\n    } finally {\n      this.unsubscribe();\n    }\n  };\n  Subscriber.prototype._complete = function () {\n    try {\n      this.destination.complete();\n    } finally {\n      this.unsubscribe();\n    }\n  };\n  return Subscriber;\n}(Subscription);\nexport { Subscriber };\nvar _bind = Function.prototype.bind;\nfunction bind(fn, thisArg) {\n  return _bind.call(fn, thisArg);\n}\nvar ConsumerObserver = function () {\n  function ConsumerObserver(partialObserver) {\n    this.partialObserver = partialObserver;\n  }\n  ConsumerObserver.prototype.next = function (value) {\n    var partialObserver = this.partialObserver;\n    if (partialObserver.next) {\n      try {\n        partialObserver.next(value);\n      } catch (error) {\n        handleUnhandledError(error);\n      }\n    }\n  };\n  ConsumerObserver.prototype.error = function (err) {\n    var partialObserver = this.partialObserver;\n    if (partialObserver.error) {\n      try {\n        partialObserver.error(err);\n      } catch (error) {\n        handleUnhandledError(error);\n      }\n    } else {\n      handleUnhandledError(err);\n    }\n  };\n  ConsumerObserver.prototype.complete = function () {\n    var partialObserver = this.partialObserver;\n    if (partialObserver.complete) {\n      try {\n        partialObserver.complete();\n      } catch (error) {\n        handleUnhandledError(error);\n      }\n    }\n  };\n  return ConsumerObserver;\n}();\nvar SafeSubscriber = function (_super) {\n  __extends(SafeSubscriber, _super);\n  function SafeSubscriber(observerOrNext, error, complete) {\n    var _this = _super.call(this) || this;\n    var partialObserver;\n    if (isFunction(observerOrNext) || !observerOrNext) {\n      partialObserver = {\n        next: observerOrNext !== null && observerOrNext !== void 0 ? observerOrNext : undefined,\n        error: error !== null && error !== void 0 ? error : undefined,\n        complete: complete !== null && complete !== void 0 ? complete : undefined\n      };\n    } else {\n      var context_1;\n      if (_this && config.useDeprecatedNextContext) {\n        context_1 = Object.create(observerOrNext);\n        context_1.unsubscribe = function () {\n          return _this.unsubscribe();\n        };\n        partialObserver = {\n          next: observerOrNext.next && bind(observerOrNext.next, context_1),\n          error: observerOrNext.error && bind(observerOrNext.error, context_1),\n          complete: observerOrNext.complete && bind(observerOrNext.complete, context_1)\n        };\n      } else {\n        partialObserver = observerOrNext;\n      }\n    }\n    _this.destination = new ConsumerObserver(partialObserver);\n    return _this;\n  }\n  return SafeSubscriber;\n}(Subscriber);\nexport { SafeSubscriber };\nfunction handleUnhandledError(error) {\n  if (config.useDeprecatedSynchronousErrorHandling) {\n    captureError(error);\n  } else {\n    reportUnhandledError(error);\n  }\n}\nfunction defaultErrorHandler(err) {\n  throw err;\n}\nfunction handleStoppedNotification(notification, subscriber) {\n  var onStoppedNotification = config.onStoppedNotification;\n  onStoppedNotification && timeoutProvider.setTimeout(function () {\n    return onStoppedNotification(notification, subscriber);\n  });\n}\nexport var EMPTY_OBSERVER = {\n  closed: true,\n  next: noop,\n  error: defaultErrorHandler,\n  complete: noop\n};","map":{"version":3,"sources":["../../../src/internal/Subscriber.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { __extends } from \"tslib\";\nimport { isFunction } from './util/isFunction';\nimport { isSubscription, Subscription } from './Subscription';\nimport { config } from './config';\nimport { reportUnhandledError } from './util/reportUnhandledError';\nimport { noop } from './util/noop';\nimport { nextNotification, errorNotification, COMPLETE_NOTIFICATION } from './NotificationFactories';\nimport { timeoutProvider } from './scheduler/timeoutProvider';\nimport { captureError } from './util/errorContext';\nvar Subscriber = (function (_super) {\n    __extends(Subscriber, _super);\n    function Subscriber(destination) {\n        var _this = _super.call(this) || this;\n        _this.isStopped = false;\n        if (destination) {\n            _this.destination = destination;\n            if (isSubscription(destination)) {\n                destination.add(_this);\n            }\n        }\n        else {\n            _this.destination = EMPTY_OBSERVER;\n        }\n        return _this;\n    }\n    Subscriber.create = function (next, error, complete) {\n        return new SafeSubscriber(next, error, complete);\n    };\n    Subscriber.prototype.next = function (value) {\n        if (this.isStopped) {\n            handleStoppedNotification(nextNotification(value), this);\n        }\n        else {\n            this._next(value);\n        }\n    };\n    Subscriber.prototype.error = function (err) {\n        if (this.isStopped) {\n            handleStoppedNotification(errorNotification(err), this);\n        }\n        else {\n            this.isStopped = true;\n            this._error(err);\n        }\n    };\n    Subscriber.prototype.complete = function () {\n        if (this.isStopped) {\n            handleStoppedNotification(COMPLETE_NOTIFICATION, this);\n        }\n        else {\n            this.isStopped = true;\n            this._complete();\n        }\n    };\n    Subscriber.prototype.unsubscribe = function () {\n        if (!this.closed) {\n            this.isStopped = true;\n            _super.prototype.unsubscribe.call(this);\n            this.destination = null;\n        }\n    };\n    Subscriber.prototype._next = function (value) {\n        this.destination.next(value);\n    };\n    Subscriber.prototype._error = function (err) {\n        try {\n            this.destination.error(err);\n        }\n        finally {\n            this.unsubscribe();\n        }\n    };\n    Subscriber.prototype._complete = function () {\n        try {\n            this.destination.complete();\n        }\n        finally {\n            this.unsubscribe();\n        }\n    };\n    return Subscriber;\n}(Subscription));\nexport { Subscriber };\nvar _bind = Function.prototype.bind;\nfunction bind(fn, thisArg) {\n    return _bind.call(fn, thisArg);\n}\nvar ConsumerObserver = (function () {\n    function ConsumerObserver(partialObserver) {\n        this.partialObserver = partialObserver;\n    }\n    ConsumerObserver.prototype.next = function (value) {\n        var partialObserver = this.partialObserver;\n        if (partialObserver.next) {\n            try {\n                partialObserver.next(value);\n            }\n            catch (error) {\n                handleUnhandledError(error);\n            }\n        }\n    };\n    ConsumerObserver.prototype.error = function (err) {\n        var partialObserver = this.partialObserver;\n        if (partialObserver.error) {\n            try {\n                partialObserver.error(err);\n            }\n            catch (error) {\n                handleUnhandledError(error);\n            }\n        }\n        else {\n            handleUnhandledError(err);\n        }\n    };\n    ConsumerObserver.prototype.complete = function () {\n        var partialObserver = this.partialObserver;\n        if (partialObserver.complete) {\n            try {\n                partialObserver.complete();\n            }\n            catch (error) {\n                handleUnhandledError(error);\n            }\n        }\n    };\n    return ConsumerObserver;\n}());\nvar SafeSubscriber = (function (_super) {\n    __extends(SafeSubscriber, _super);\n    function SafeSubscriber(observerOrNext, error, complete) {\n        var _this = _super.call(this) || this;\n        var partialObserver;\n        if (isFunction(observerOrNext) || !observerOrNext) {\n            partialObserver = {\n                next: (observerOrNext !== null && observerOrNext !== void 0 ? observerOrNext : undefined),\n                error: error !== null && error !== void 0 ? error : undefined,\n                complete: complete !== null && complete !== void 0 ? complete : undefined,\n            };\n        }\n        else {\n            var context_1;\n            if (_this && config.useDeprecatedNextContext) {\n                context_1 = Object.create(observerOrNext);\n                context_1.unsubscribe = function () { return _this.unsubscribe(); };\n                partialObserver = {\n                    next: observerOrNext.next && bind(observerOrNext.next, context_1),\n                    error: observerOrNext.error && bind(observerOrNext.error, context_1),\n                    complete: observerOrNext.complete && bind(observerOrNext.complete, context_1),\n                };\n            }\n            else {\n                partialObserver = observerOrNext;\n            }\n        }\n        _this.destination = new ConsumerObserver(partialObserver);\n        return _this;\n    }\n    return SafeSubscriber;\n}(Subscriber));\nexport { SafeSubscriber };\nfunction handleUnhandledError(error) {\n    if (config.useDeprecatedSynchronousErrorHandling) {\n        captureError(error);\n    }\n    else {\n        reportUnhandledError(error);\n    }\n}\nfunction defaultErrorHandler(err) {\n    throw err;\n}\nfunction handleStoppedNotification(notification, subscriber) {\n    var onStoppedNotification = config.onStoppedNotification;\n    onStoppedNotification && timeoutProvider.setTimeout(function () { return onStoppedNotification(notification, subscriber); });\n}\nexport var EMPTY_OBSERVER = {\n    closed: true,\n    next: noop,\n    error: defaultErrorHandler,\n    complete: noop,\n};\n//# sourceMappingURL=Subscriber.js.map"]},"metadata":{},"sourceType":"module"}