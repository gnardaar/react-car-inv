{"code":"(this[\"webpackJsonpreact-pb\"]=this[\"webpackJsonpreact-pb\"]||[]).push([[0],{241:function(e,t,n){\"use strict\";var r,i=n(13),o=n(78),a=n(9),s=n(34),u=n(242),c=\"0.4.32\",f=1e4,l=\"w:\"+c,p=\"FIS_v2\",d=36e5,h=((r={})[\"missing-app-config-values\"]='Missing App configuration value: \"{$valueName}\"',r[\"not-registered\"]=\"Firebase Installation is not registered.\",r[\"installation-not-found\"]=\"Firebase Installation not found.\",r[\"request-failed\"]='{$requestName} request failed with error \"{$serverCode} {$serverStatus}: {$serverMessage}\"',r[\"app-offline\"]=\"Could not process request. Application offline.\",r[\"delete-pending-registration\"]=\"Can't delete installation while there is a pending registration request.\",r),v=new s.b(\"installations\",\"Installations\",h);function b(e){return e instanceof s.c&&e.code.includes(\"request-failed\")}function g(e){return\"https://firebaseinstallations.googleapis.com/v1/projects/\"+e.projectId+\"/installations\"}function y(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace(\"s\",\"000\"))),creationTime:Date.now()};var t}function j(e,t){return Object(a.e)(this,void 0,void 0,(function(){var n,r;return Object(a.g)(this,(function(i){switch(i.label){case 0:return[4,t.json()];case 1:return n=i.sent(),r=n.error,[2,v.create(\"request-failed\",{requestName:e,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})]}}))}))}function m(e){var t=e.apiKey;return new Headers({\"Content-Type\":\"application/json\",Accept:\"application/json\",\"x-goog-api-key\":t})}function w(e,t){var n=t.refreshToken,r=m(e);return r.append(\"Authorization\",function(e){return p+\" \"+e}(n)),r}function O(e){return Object(a.e)(this,void 0,void 0,(function(){var t;return Object(a.g)(this,(function(n){switch(n.label){case 0:return[4,e()];case 1:return(t=n.sent()).status>=500&&t.status<600?[2,e()]:[2,t]}}))}))}function S(e,t){var n=t.fid;return Object(a.e)(this,void 0,void 0,(function(){var t,r,i,o,s,u;return Object(a.g)(this,(function(a){switch(a.label){case 0:return t=g(e),r=m(e),i={fid:n,authVersion:p,appId:e.appId,sdkVersion:l},o={method:\"POST\",headers:r,body:JSON.stringify(i)},[4,O((function(){return fetch(t,o)}))];case 1:return(s=a.sent()).ok?[4,s.json()]:[3,3];case 2:return u=a.sent(),[2,{fid:u.fid||n,registrationStatus:2,refreshToken:u.refreshToken,authToken:y(u.authToken)}];case 3:return[4,j(\"Create Installation\",s)];case 4:throw a.sent()}}))}))}function I(e){return new Promise((function(t){setTimeout(t,e)}))}var _=/^[cdef][\\w-]{21}$/;function C(){try{var e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;var t=function(e){var t=(n=e,btoa(String.fromCharCode.apply(String,Object(a.i)([],Object(a.h)(n)))).replace(/\\+/g,\"-\").replace(/\\//g,\"_\"));var n;return t.substr(0,22)}(e);return _.test(t)?t:\"\"}catch(r){return\"\"}}function k(e){return e.appName+\"!\"+e.appId}var T=new Map;function D(e,t){var n=k(e);x(n,t),function(e,t){var n=q();n&&n.postMessage({key:e,fid:t});E()}(n,t)}function x(e,t){var n,r,i=T.get(e);if(i)try{for(var o=Object(a.j)(i),s=o.next();!s.done;s=o.next()){(0,s.value)(t)}}catch(u){n={error:u}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}var P=null;function q(){return!P&&\"BroadcastChannel\"in self&&((P=new BroadcastChannel(\"[Firebase] FID Change\")).onmessage=function(e){x(e.data.key,e.data.fid)}),P}function E(){0===T.size&&P&&(P.close(),P=null)}var A,N=\"firebase-installations-store\",B=null;function K(){return B||(B=Object(u.openDb)(\"firebase-installations-database\",1,(function(e){if(0===e.oldVersion)e.createObjectStore(N)}))),B}function L(e,t){return Object(a.e)(this,void 0,void 0,(function(){var n,r,i,o,s;return Object(a.g)(this,(function(a){switch(a.label){case 0:return n=k(e),[4,K()];case 1:return r=a.sent(),i=r.transaction(N,\"readwrite\"),[4,(o=i.objectStore(N)).get(n)];case 2:return s=a.sent(),[4,o.put(t,n)];case 3:return a.sent(),[4,i.complete];case 4:return a.sent(),s&&s.fid===t.fid||D(e,t.fid),[2,t]}}))}))}function V(e){return Object(a.e)(this,void 0,void 0,(function(){var t,n,r;return Object(a.g)(this,(function(i){switch(i.label){case 0:return t=k(e),[4,K()];case 1:return n=i.sent(),[4,(r=n.transaction(N,\"readwrite\")).objectStore(N).delete(t)];case 2:return i.sent(),[4,r.complete];case 3:return i.sent(),[2]}}))}))}function M(e,t){return Object(a.e)(this,void 0,void 0,(function(){var n,r,i,o,s,u;return Object(a.g)(this,(function(a){switch(a.label){case 0:return n=k(e),[4,K()];case 1:return r=a.sent(),i=r.transaction(N,\"readwrite\"),[4,(o=i.objectStore(N)).get(n)];case 2:return s=a.sent(),void 0!==(u=t(s))?[3,4]:[4,o.delete(n)];case 3:return a.sent(),[3,6];case 4:return[4,o.put(u,n)];case 5:a.sent(),a.label=6;case 6:return[4,i.complete];case 7:return a.sent(),!u||s&&s.fid===u.fid||D(e,u.fid),[2,u]}}))}))}function $(e){return Object(a.e)(this,void 0,void 0,(function(){var t,n,r;return Object(a.g)(this,(function(i){switch(i.label){case 0:return[4,M(e,(function(n){var r=function(e){var t=e||{fid:C(),registrationStatus:0};return z(t)}(n),i=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(v.create(\"app-offline\"))};var n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},r=function(e,t){return Object(a.e)(this,void 0,void 0,(function(){var n,r;return Object(a.g)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,7]),[4,S(e,t)];case 1:return n=i.sent(),[2,L(e,n)];case 2:return b(r=i.sent())&&409===r.customData.serverCode?[4,V(e)]:[3,4];case 3:return i.sent(),[3,6];case 4:return[4,L(e,{fid:t.fid,registrationStatus:0})];case 5:i.sent(),i.label=6;case 6:throw r;case 7:return[2]}}))}))}(e,n);return{installationEntry:n,registrationPromise:r}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:F(e)}:{installationEntry:t}}(e,r);return t=i.registrationPromise,i.installationEntry}))];case 1:return\"\"!==(n=i.sent()).fid?[3,3]:(r={},[4,t]);case 2:return[2,(r.installationEntry=i.sent(),r)];case 3:return[2,{installationEntry:n,registrationPromise:t}]}}))}))}function F(e){return Object(a.e)(this,void 0,void 0,(function(){var t,n,r,i;return Object(a.g)(this,(function(o){switch(o.label){case 0:return[4,J(e)];case 1:t=o.sent(),o.label=2;case 2:return 1!==t.registrationStatus?[3,5]:[4,I(100)];case 3:return o.sent(),[4,J(e)];case 4:return t=o.sent(),[3,2];case 5:return 0!==t.registrationStatus?[3,7]:[4,$(e)];case 6:return n=o.sent(),r=n.installationEntry,(i=n.registrationPromise)?[2,i]:[2,r];case 7:return[2,t]}}))}))}function J(e){return M(e,(function(e){if(!e)throw v.create(\"installation-not-found\");return z(e)}))}function z(e){return 1===(t=e).registrationStatus&&t.registrationTime+f<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}function R(e,t){var n=e.appConfig,r=e.platformLoggerProvider;return Object(a.e)(this,void 0,void 0,(function(){var e,i,o,s,u,c,f;return Object(a.g)(this,(function(a){switch(a.label){case 0:return e=function(e,t){var n=t.fid;return g(e)+\"/\"+n+\"/authTokens:generate\"}(n,t),i=w(n,t),(o=r.getImmediate({optional:!0}))&&i.append(\"x-firebase-client\",o.getPlatformInfoString()),s={installation:{sdkVersion:l}},u={method:\"POST\",headers:i,body:JSON.stringify(s)},[4,O((function(){return fetch(e,u)}))];case 1:return(c=a.sent()).ok?[4,c.json()]:[3,3];case 2:return f=a.sent(),[2,y(f)];case 3:return[4,j(\"Generate Auth Token\",c)];case 4:throw a.sent()}}))}))}function U(e,t){return void 0===t&&(t=!1),Object(a.e)(this,void 0,void 0,(function(){var n,r,i;return Object(a.g)(this,(function(o){switch(o.label){case 0:return[4,M(e.appConfig,(function(r){if(!H(r))throw v.create(\"not-registered\");var i=r.authToken;if(!t&&function(e){return 2===e.requestStatus&&!function(e){var t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+d}(e)}(i))return r;if(1===i.requestStatus)return n=function(e,t){return Object(a.e)(this,void 0,void 0,(function(){var n,r;return Object(a.g)(this,(function(i){switch(i.label){case 0:return[4,G(e.appConfig)];case 1:n=i.sent(),i.label=2;case 2:return 1!==n.authToken.requestStatus?[3,5]:[4,I(100)];case 3:return i.sent(),[4,G(e.appConfig)];case 4:return n=i.sent(),[3,2];case 5:return 0===(r=n.authToken).requestStatus?[2,U(e,t)]:[2,r]}}))}))}(e,t),r;if(!navigator.onLine)throw v.create(\"app-offline\");var o=function(e){var t={requestStatus:1,requestTime:Date.now()};return Object(a.a)(Object(a.a)({},e),{authToken:t})}(r);return n=function(e,t){return Object(a.e)(this,void 0,void 0,(function(){var n,r,i;return Object(a.g)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,8]),[4,R(e,t)];case 1:return n=o.sent(),i=Object(a.a)(Object(a.a)({},t),{authToken:n}),[4,L(e.appConfig,i)];case 2:return o.sent(),[2,n];case 3:return!b(r=o.sent())||401!==r.customData.serverCode&&404!==r.customData.serverCode?[3,5]:[4,V(e.appConfig)];case 4:return o.sent(),[3,7];case 5:return i=Object(a.a)(Object(a.a)({},t),{authToken:{requestStatus:0}}),[4,L(e.appConfig,i)];case 6:o.sent(),o.label=7;case 7:throw r;case 8:return[2]}}))}))}(e,o),o}))];case 1:return r=o.sent(),n?[4,n]:[3,3];case 2:return i=o.sent(),[3,4];case 3:i=r.authToken,o.label=4;case 4:return[2,i]}}))}))}function G(e){return M(e,(function(e){if(!H(e))throw v.create(\"not-registered\");var t,n=e.authToken;return 1===(t=n).requestStatus&&t.requestTime+f<Date.now()?Object(a.a)(Object(a.a)({},e),{authToken:{requestStatus:0}}):e}))}function H(e){return void 0!==e&&2===e.registrationStatus}function Q(e){return Object(a.e)(this,void 0,void 0,(function(){var t;return Object(a.g)(this,(function(n){switch(n.label){case 0:return[4,$(e)];case 1:return(t=n.sent().registrationPromise)?[4,t]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))}function W(e,t){return Object(a.e)(this,void 0,void 0,(function(){var n,r,i,o;return Object(a.g)(this,(function(a){switch(a.label){case 0:return n=function(e,t){var n=t.fid;return g(e)+\"/\"+n}(e,t),r=w(e,t),i={method:\"DELETE\",headers:r},[4,O((function(){return fetch(n,i)}))];case 1:return(o=a.sent()).ok?[3,3]:[4,j(\"Delete Installation\",o)];case 2:throw a.sent();case 3:return[2]}}))}))}function X(e,t){var n=e.appConfig;return function(e,t){q();var n=k(e),r=T.get(n);r||(r=new Set,T.set(n,r)),r.add(t)}(n,t),function(){!function(e,t){var n=k(e),r=T.get(n);r&&(r.delete(t),0===r.size&&T.delete(n),E())}(n,t)}}function Y(e){return v.create(\"missing-app-config-values\",{valueName:e})}(A=i.a).INTERNAL.registerComponent(new o.a(\"installations\",(function(e){var t=e.getProvider(\"app\").getImmediate(),n=function(e){var t,n;if(!e||!e.options)throw Y(\"App Configuration\");if(!e.name)throw Y(\"App Name\");try{for(var r=Object(a.j)([\"projectId\",\"apiKey\",\"appId\"]),i=r.next();!i.done;i=r.next()){var o=i.value;if(!e.options[o])throw Y(o)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t),r={appConfig:n,platformLoggerProvider:e.getProvider(\"platform-logger\")},i={app:t,getId:function(){return function(e){return Object(a.e)(this,void 0,void 0,(function(){var t,n,r;return Object(a.g)(this,(function(i){switch(i.label){case 0:return[4,$(e.appConfig)];case 1:return t=i.sent(),n=t.installationEntry,(r=t.registrationPromise)?r.catch(console.error):U(e).catch(console.error),[2,n.fid]}}))}))}(r)},getToken:function(e){return function(e,t){return void 0===t&&(t=!1),Object(a.e)(this,void 0,void 0,(function(){return Object(a.g)(this,(function(n){switch(n.label){case 0:return[4,Q(e.appConfig)];case 1:return n.sent(),[4,U(e,t)];case 2:return[2,n.sent().token]}}))}))}(r,e)},delete:function(){return function(e){return Object(a.e)(this,void 0,void 0,(function(){var t,n;return Object(a.g)(this,(function(r){switch(r.label){case 0:return[4,M(t=e.appConfig,(function(e){if(!e||0!==e.registrationStatus)return e}))];case 1:if(!(n=r.sent()))return[3,6];if(1!==n.registrationStatus)return[3,2];throw v.create(\"delete-pending-registration\");case 2:if(2!==n.registrationStatus)return[3,6];if(navigator.onLine)return[3,3];throw v.create(\"app-offline\");case 3:return[4,W(t,n)];case 4:return r.sent(),[4,V(t)];case 5:r.sent(),r.label=6;case 6:return[2]}}))}))}(r)},onIdChange:function(e){return X(r,e)}};return i}),\"PUBLIC\")),A.registerVersion(\"@firebase/installations\",c)},242:function(e,t,n){!function(e){\"use strict\";function t(e){return Array.prototype.slice.call(e)}function n(e){return new Promise((function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}}))}function r(e,t,r){var i,o=new Promise((function(o,a){n(i=e[t].apply(e,r)).then(o,a)}));return o.request=i,o}function i(e,t,n){var i=r(e,t,n);return i.then((function(e){if(e)return new f(e,i.request)}))}function o(e,t,n){n.forEach((function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})}))}function a(e,t,n,i){i.forEach((function(i){i in n.prototype&&(e.prototype[i]=function(){return r(this[t],i,arguments)})}))}function s(e,t,n,r){r.forEach((function(r){r in n.prototype&&(e.prototype[r]=function(){return this[t][r].apply(this[t],arguments)})}))}function u(e,t,n,r){r.forEach((function(r){r in n.prototype&&(e.prototype[r]=function(){return i(this[t],r,arguments)})}))}function c(e){this._index=e}function f(e,t){this._cursor=e,this._request=t}function l(e){this._store=e}function p(e){this._tx=e,this.complete=new Promise((function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}}))}function d(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new p(n)}function h(e){this._db=e}function v(e,t,n){var i=r(indexedDB,\"open\",[e,t]),o=i.request;return o&&(o.onupgradeneeded=function(e){n&&n(new d(o.result,e.oldVersion,o.transaction))}),i.then((function(e){return new h(e)}))}function b(e){return r(indexedDB,\"deleteDatabase\",[e])}o(c,\"_index\",[\"name\",\"keyPath\",\"multiEntry\",\"unique\"]),a(c,\"_index\",IDBIndex,[\"get\",\"getKey\",\"getAll\",\"getAllKeys\",\"count\"]),u(c,\"_index\",IDBIndex,[\"openCursor\",\"openKeyCursor\"]),o(f,\"_cursor\",[\"direction\",\"key\",\"primaryKey\",\"value\"]),a(f,\"_cursor\",IDBCursor,[\"update\",\"delete\"]),[\"advance\",\"continue\",\"continuePrimaryKey\"].forEach((function(e){e in IDBCursor.prototype&&(f.prototype[e]=function(){var t=this,r=arguments;return Promise.resolve().then((function(){return t._cursor[e].apply(t._cursor,r),n(t._request).then((function(e){if(e)return new f(e,t._request)}))}))})})),l.prototype.createIndex=function(){return new c(this._store.createIndex.apply(this._store,arguments))},l.prototype.index=function(){return new c(this._store.index.apply(this._store,arguments))},o(l,\"_store\",[\"name\",\"keyPath\",\"indexNames\",\"autoIncrement\"]),a(l,\"_store\",IDBObjectStore,[\"put\",\"add\",\"delete\",\"clear\",\"get\",\"getAll\",\"getKey\",\"getAllKeys\",\"count\"]),u(l,\"_store\",IDBObjectStore,[\"openCursor\",\"openKeyCursor\"]),s(l,\"_store\",IDBObjectStore,[\"deleteIndex\"]),p.prototype.objectStore=function(){return new l(this._tx.objectStore.apply(this._tx,arguments))},o(p,\"_tx\",[\"objectStoreNames\",\"mode\"]),s(p,\"_tx\",IDBTransaction,[\"abort\"]),d.prototype.createObjectStore=function(){return new l(this._db.createObjectStore.apply(this._db,arguments))},o(d,\"_db\",[\"name\",\"version\",\"objectStoreNames\"]),s(d,\"_db\",IDBDatabase,[\"deleteObjectStore\",\"close\"]),h.prototype.transaction=function(){return new p(this._db.transaction.apply(this._db,arguments))},o(h,\"_db\",[\"name\",\"version\",\"objectStoreNames\"]),s(h,\"_db\",IDBDatabase,[\"close\"]),[\"openCursor\",\"openKeyCursor\"].forEach((function(e){[l,c].forEach((function(n){e in n.prototype&&(n.prototype[e.replace(\"open\",\"iterate\")]=function(){var n=t(arguments),r=n[n.length-1],i=this._store||this._index,o=i[e].apply(i,n.slice(0,-1));o.onsuccess=function(){r(o.result)}})}))})),[c,l].forEach((function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,r=[];return new Promise((function(i){n.iterateCursor(e,(function(e){e?(r.push(e.value),void 0===t||r.length!=t?e.continue():i(r)):i(r)}))}))})})),e.openDb=v,e.deleteDb=b,Object.defineProperty(e,\"__esModule\",{value:!0})}(t)}}]);","name":"static/js/0.f58b5666.chunk.js","map":{"version":3,"names":["this","push","module","__webpack_exports__","__webpack_require__","_a","_firebase_app__WEBPACK_IMPORTED_MODULE_0__","_firebase_component__WEBPACK_IMPORTED_MODULE_1__","tslib__WEBPACK_IMPORTED_MODULE_2__","_firebase_util__WEBPACK_IMPORTED_MODULE_3__","idb__WEBPACK_IMPORTED_MODULE_4__","version","PENDING_TIMEOUT_MS","PACKAGE_VERSION","INTERNAL_AUTH_VERSION","TOKEN_EXPIRATION_BUFFER","ERROR_DESCRIPTION_MAP","ERROR_FACTORY","isServerError","error","code","includes","getInstallationsEndpoint","INSTALLATIONS_API_URL","projectId","extractAuthTokenInfoFromResponse","response","token","requestStatus","expiresIn","responseExpiresIn","Number","replace","creationTime","Date","now","getErrorFromResponse","requestName","Object","responseJson","errorData","label","json","sent","create","serverCode","serverMessage","message","serverStatus","status","getHeaders","apiKey","Headers","Accept","getHeadersWithAuth","appConfig","refreshToken","headers","append","getAuthorizationHeader","retryIfServerError","fn","result","createInstallationRequest","fid","endpoint","body","request","responseValue","_b","authVersion","appId","sdkVersion","method","JSON","stringify","fetch","ok","registrationStatus","authToken","sleep","ms","Promise","resolve","setTimeout","VALID_FID_PATTERN","generateFid","fidByteArray","Uint8Array","self","crypto","msCrypto","getRandomValues","b64String","array","btoa","String","fromCharCode","apply","substr","encode","test","getKey","appName","fidChangeCallbacks","Map","fidChanged","key","callFidChangeCallbacks","channel","getBroadcastChannel","postMessage","closeBroadcastChannel","broadcastFidChange","e_1","callbacks","get","callbacks_1","callbacks_1_1","next","done","callback","value","e_1_1","return","call","broadcastChannel","BroadcastChannel","onmessage","e","data","size","close","instance","OBJECT_STORE_NAME","dbPromise","getDbPromise","upgradeDB","oldVersion","createObjectStore","set","db","tx","objectStore","oldValue","transaction","put","complete","remove","delete","update","updateFn","store","newValue","undefined","getInstallationEntry","registrationPromise","installationEntry","oldEntry","entry","clearTimedOutRequest","updateOrCreateInstallationEntry","entryWithPromise","navigator","onLine","reject","inProgressEntry","registrationTime","registeredInstallationEntry","trys","customData","registerInstallation","waitUntilFidRegistration","triggerRegistrationIfNecessary","updateInstallationRequest","generateAuthTokenRequest","platformLoggerProvider","platformLogger","getGenerateAuthTokenEndpoint","getImmediate","optional","getPlatformInfoString","installation","refreshAuthToken","dependencies","forceRefresh","tokenPromise","isEntryRegistered","oldAuthToken","isAuthTokenExpired","isAuthTokenValid","updateAuthTokenRequest","waitUntilAuthTokenRequest","inProgressAuthToken","requestTime","makeAuthTokenRequestInProgressEntry","updatedInstallationEntry","fetchAuthTokenFromServer","completeInstallationRegistration","deleteInstallationRequest","getDeleteEndpoint","_onIdChange","callbackSet","Set","add","addCallback","removeCallback","getMissingValueError","valueName","INTERNAL","registerComponent","container","app","getProvider","options","name","configKeys_1","configKeys_1_1","keyName","extractAppConfig","installations","getId","catch","console","_getId","getToken","_getToken","deleteInstallation","onIdChange","registerVersion","exports","toArray","arr","Array","prototype","slice","promisifyRequest","onsuccess","onerror","promisifyRequestCall","obj","args","p","then","promisifyCursorRequestCall","Cursor","proxyProperties","ProxyClass","targetProp","properties","forEach","prop","defineProperty","val","proxyRequestMethods","Constructor","arguments","proxyMethods","proxyCursorRequestMethods","Index","index","_index","cursor","_cursor","_request","ObjectStore","_store","Transaction","idbTransaction","_tx","oncomplete","onabort","UpgradeDB","_db","DB","openDb","upgradeCallback","indexedDB","onupgradeneeded","event","deleteDb","IDBIndex","IDBCursor","methodName","createIndex","IDBObjectStore","IDBTransaction","IDBDatabase","funcName","length","nativeObject","getAll","query","count","items","iterateCursor","continue","factory"],"sources":["static/js/0.f58b5666.chunk.js"],"mappings":"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"},"input":"(this[\"webpackJsonpreact-pb\"] = this[\"webpackJsonpreact-pb\"] || []).push([[0],{\n\n/***/ 241:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* unused harmony export registerInstallations */\n/* harmony import */ var _firebase_app__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(13);\n/* harmony import */ var _firebase_component__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(78);\n/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(9);\n/* harmony import */ var _firebase_util__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(34);\n/* harmony import */ var idb__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(242);\n/* harmony import */ var idb__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(idb__WEBPACK_IMPORTED_MODULE_4__);\n\n\n\n\n\nvar name = \"@firebase/installations\";\nvar version = \"0.4.32\";\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar PENDING_TIMEOUT_MS = 10000;\nvar PACKAGE_VERSION = \"w:\" + version;\nvar INTERNAL_AUTH_VERSION = 'FIS_v2';\nvar INSTALLATIONS_API_URL = 'https://firebaseinstallations.googleapis.com/v1';\nvar TOKEN_EXPIRATION_BUFFER = 60 * 60 * 1000; // One hour\nvar SERVICE = 'installations';\nvar SERVICE_NAME = 'Installations';\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar _a;\nvar ERROR_DESCRIPTION_MAP = (_a = {}, _a[\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */] = 'Missing App configuration value: \"{$valueName}\"', _a[\"not-registered\" /* NOT_REGISTERED */] = 'Firebase Installation is not registered.', _a[\"installation-not-found\" /* INSTALLATION_NOT_FOUND */] = 'Firebase Installation not found.', _a[\"request-failed\" /* REQUEST_FAILED */] = '{$requestName} request failed with error \"{$serverCode} {$serverStatus}: {$serverMessage}\"', _a[\"app-offline\" /* APP_OFFLINE */] = 'Could not process request. Application offline.', _a[\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */] = \"Can't delete installation while there is a pending registration request.\", _a);\nvar ERROR_FACTORY = new _firebase_util__WEBPACK_IMPORTED_MODULE_3__[/* ErrorFactory */ \"b\"](SERVICE, SERVICE_NAME, ERROR_DESCRIPTION_MAP);\n/** Returns true if error is a FirebaseError that is based on an error from the server. */\nfunction isServerError(error) {\n  return error instanceof _firebase_util__WEBPACK_IMPORTED_MODULE_3__[/* FirebaseError */ \"c\"] && error.code.includes(\"request-failed\" /* REQUEST_FAILED */);\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nfunction getInstallationsEndpoint(_a) {\n  var projectId = _a.projectId;\n  return INSTALLATIONS_API_URL + \"/projects/\" + projectId + \"/installations\";\n}\nfunction extractAuthTokenInfoFromResponse(response) {\n  return {\n    token: response.token,\n    requestStatus: 2 /* COMPLETED */,\n    expiresIn: getExpiresInFromResponseExpiresIn(response.expiresIn),\n    creationTime: Date.now()\n  };\n}\nfunction getErrorFromResponse(requestName, response) {\n  return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __awaiter */ \"e\"])(this, void 0, void 0, function () {\n    var responseJson, errorData;\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __generator */ \"g\"])(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4 /*yield*/, response.json()];\n        case 1:\n          responseJson = _a.sent();\n          errorData = responseJson.error;\n          return [2 /*return*/, ERROR_FACTORY.create(\"request-failed\" /* REQUEST_FAILED */, {\n            requestName: requestName,\n            serverCode: errorData.code,\n            serverMessage: errorData.message,\n            serverStatus: errorData.status\n          })];\n      }\n    });\n  });\n}\nfunction getHeaders(_a) {\n  var apiKey = _a.apiKey;\n  return new Headers({\n    'Content-Type': 'application/json',\n    Accept: 'application/json',\n    'x-goog-api-key': apiKey\n  });\n}\nfunction getHeadersWithAuth(appConfig, _a) {\n  var refreshToken = _a.refreshToken;\n  var headers = getHeaders(appConfig);\n  headers.append('Authorization', getAuthorizationHeader(refreshToken));\n  return headers;\n}\n/**\r\n * Calls the passed in fetch wrapper and returns the response.\r\n * If the returned response has a status of 5xx, re-runs the function once and\r\n * returns the response.\r\n */\nfunction retryIfServerError(fn) {\n  return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __awaiter */ \"e\"])(this, void 0, void 0, function () {\n    var result;\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __generator */ \"g\"])(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4 /*yield*/, fn()];\n        case 1:\n          result = _a.sent();\n          if (result.status >= 500 && result.status < 600) {\n            // Internal Server Error. Retry request.\n            return [2 /*return*/, fn()];\n          }\n          return [2 /*return*/, result];\n      }\n    });\n  });\n}\nfunction getExpiresInFromResponseExpiresIn(responseExpiresIn) {\n  // This works because the server will never respond with fractions of a second.\n  return Number(responseExpiresIn.replace('s', '000'));\n}\nfunction getAuthorizationHeader(refreshToken) {\n  return INTERNAL_AUTH_VERSION + \" \" + refreshToken;\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nfunction createInstallationRequest(appConfig, _a) {\n  var fid = _a.fid;\n  return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __awaiter */ \"e\"])(this, void 0, void 0, function () {\n    var endpoint, headers, body, request, response, responseValue, registeredInstallationEntry;\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __generator */ \"g\"])(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          endpoint = getInstallationsEndpoint(appConfig);\n          headers = getHeaders(appConfig);\n          body = {\n            fid: fid,\n            authVersion: INTERNAL_AUTH_VERSION,\n            appId: appConfig.appId,\n            sdkVersion: PACKAGE_VERSION\n          };\n          request = {\n            method: 'POST',\n            headers: headers,\n            body: JSON.stringify(body)\n          };\n          return [4 /*yield*/, retryIfServerError(function () {\n            return fetch(endpoint, request);\n          })];\n        case 1:\n          response = _b.sent();\n          if (!response.ok) return [3 /*break*/, 3];\n          return [4 /*yield*/, response.json()];\n        case 2:\n          responseValue = _b.sent();\n          registeredInstallationEntry = {\n            fid: responseValue.fid || fid,\n            registrationStatus: 2 /* COMPLETED */,\n            refreshToken: responseValue.refreshToken,\n            authToken: extractAuthTokenInfoFromResponse(responseValue.authToken)\n          };\n          return [2 /*return*/, registeredInstallationEntry];\n        case 3:\n          return [4 /*yield*/, getErrorFromResponse('Create Installation', response)];\n        case 4:\n          throw _b.sent();\n      }\n    });\n  });\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/** Returns a promise that resolves after given time passes. */\nfunction sleep(ms) {\n  return new Promise(function (resolve) {\n    setTimeout(resolve, ms);\n  });\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nfunction bufferToBase64UrlSafe(array) {\n  var b64 = btoa(String.fromCharCode.apply(String, Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __spreadArray */ \"i\"])([], Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __read */ \"h\"])(array))));\n  return b64.replace(/\\+/g, '-').replace(/\\//g, '_');\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar VALID_FID_PATTERN = /^[cdef][\\w-]{21}$/;\nvar INVALID_FID = '';\n/**\r\n * Generates a new FID using random values from Web Crypto API.\r\n * Returns an empty string if FID generation fails for any reason.\r\n */\nfunction generateFid() {\n  try {\n    // A valid FID has exactly 22 base64 characters, which is 132 bits, or 16.5\n    // bytes. our implementation generates a 17 byte array instead.\n    var fidByteArray = new Uint8Array(17);\n    var crypto_1 = self.crypto || self.msCrypto;\n    crypto_1.getRandomValues(fidByteArray);\n    // Replace the first 4 random bits with the constant FID header of 0b0111.\n    fidByteArray[0] = 112 + fidByteArray[0] % 16;\n    var fid = encode(fidByteArray);\n    return VALID_FID_PATTERN.test(fid) ? fid : INVALID_FID;\n  } catch (_a) {\n    // FID generation errored\n    return INVALID_FID;\n  }\n}\n/** Converts a FID Uint8Array to a base64 string representation. */\nfunction encode(fidByteArray) {\n  var b64String = bufferToBase64UrlSafe(fidByteArray);\n  // Remove the 23rd character that was added because of the extra 4 bits at the\n  // end of our 17 byte array, and the '=' padding.\n  return b64String.substr(0, 22);\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/** Returns a string key that can be used to identify the app. */\nfunction getKey(appConfig) {\n  return appConfig.appName + \"!\" + appConfig.appId;\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar fidChangeCallbacks = new Map();\n/**\r\n * Calls the onIdChange callbacks with the new FID value, and broadcasts the\r\n * change to other tabs.\r\n */\nfunction fidChanged(appConfig, fid) {\n  var key = getKey(appConfig);\n  callFidChangeCallbacks(key, fid);\n  broadcastFidChange(key, fid);\n}\nfunction addCallback(appConfig, callback) {\n  // Open the broadcast channel if it's not already open,\n  // to be able to listen to change events from other tabs.\n  getBroadcastChannel();\n  var key = getKey(appConfig);\n  var callbackSet = fidChangeCallbacks.get(key);\n  if (!callbackSet) {\n    callbackSet = new Set();\n    fidChangeCallbacks.set(key, callbackSet);\n  }\n  callbackSet.add(callback);\n}\nfunction removeCallback(appConfig, callback) {\n  var key = getKey(appConfig);\n  var callbackSet = fidChangeCallbacks.get(key);\n  if (!callbackSet) {\n    return;\n  }\n  callbackSet.delete(callback);\n  if (callbackSet.size === 0) {\n    fidChangeCallbacks.delete(key);\n  }\n  // Close broadcast channel if there are no more callbacks.\n  closeBroadcastChannel();\n}\nfunction callFidChangeCallbacks(key, fid) {\n  var e_1, _a;\n  var callbacks = fidChangeCallbacks.get(key);\n  if (!callbacks) {\n    return;\n  }\n  try {\n    for (var callbacks_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __values */ \"j\"])(callbacks), callbacks_1_1 = callbacks_1.next(); !callbacks_1_1.done; callbacks_1_1 = callbacks_1.next()) {\n      var callback = callbacks_1_1.value;\n      callback(fid);\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (callbacks_1_1 && !callbacks_1_1.done && (_a = callbacks_1.return)) _a.call(callbacks_1);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n}\nfunction broadcastFidChange(key, fid) {\n  var channel = getBroadcastChannel();\n  if (channel) {\n    channel.postMessage({\n      key: key,\n      fid: fid\n    });\n  }\n  closeBroadcastChannel();\n}\nvar broadcastChannel = null;\n/** Opens and returns a BroadcastChannel if it is supported by the browser. */\nfunction getBroadcastChannel() {\n  if (!broadcastChannel && 'BroadcastChannel' in self) {\n    broadcastChannel = new BroadcastChannel('[Firebase] FID Change');\n    broadcastChannel.onmessage = function (e) {\n      callFidChangeCallbacks(e.data.key, e.data.fid);\n    };\n  }\n  return broadcastChannel;\n}\nfunction closeBroadcastChannel() {\n  if (fidChangeCallbacks.size === 0 && broadcastChannel) {\n    broadcastChannel.close();\n    broadcastChannel = null;\n  }\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar DATABASE_NAME = 'firebase-installations-database';\nvar DATABASE_VERSION = 1;\nvar OBJECT_STORE_NAME = 'firebase-installations-store';\nvar dbPromise = null;\nfunction getDbPromise() {\n  if (!dbPromise) {\n    dbPromise = Object(idb__WEBPACK_IMPORTED_MODULE_4__[\"openDb\"])(DATABASE_NAME, DATABASE_VERSION, function (upgradeDB) {\n      // We don't use 'break' in this switch statement, the fall-through\n      // behavior is what we want, because if there are multiple versions between\n      // the old version and the current version, we want ALL the migrations\n      // that correspond to those versions to run, not only the last one.\n      // eslint-disable-next-line default-case\n      switch (upgradeDB.oldVersion) {\n        case 0:\n          upgradeDB.createObjectStore(OBJECT_STORE_NAME);\n      }\n    });\n  }\n  return dbPromise;\n}\n/** Assigns or overwrites the record for the given key with the given value. */\nfunction set(appConfig, value) {\n  return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __awaiter */ \"e\"])(this, void 0, void 0, function () {\n    var key, db, tx, objectStore, oldValue;\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __generator */ \"g\"])(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(appConfig);\n          return [4 /*yield*/, getDbPromise()];\n        case 1:\n          db = _a.sent();\n          tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n          objectStore = tx.objectStore(OBJECT_STORE_NAME);\n          return [4 /*yield*/, objectStore.get(key)];\n        case 2:\n          oldValue = _a.sent();\n          return [4 /*yield*/, objectStore.put(value, key)];\n        case 3:\n          _a.sent();\n          return [4 /*yield*/, tx.complete];\n        case 4:\n          _a.sent();\n          if (!oldValue || oldValue.fid !== value.fid) {\n            fidChanged(appConfig, value.fid);\n          }\n          return [2 /*return*/, value];\n      }\n    });\n  });\n}\n/** Removes record(s) from the objectStore that match the given key. */\nfunction remove(appConfig) {\n  return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __awaiter */ \"e\"])(this, void 0, void 0, function () {\n    var key, db, tx;\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __generator */ \"g\"])(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(appConfig);\n          return [4 /*yield*/, getDbPromise()];\n        case 1:\n          db = _a.sent();\n          tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n          return [4 /*yield*/, tx.objectStore(OBJECT_STORE_NAME).delete(key)];\n        case 2:\n          _a.sent();\n          return [4 /*yield*/, tx.complete];\n        case 3:\n          _a.sent();\n          return [2 /*return*/];\n      }\n    });\n  });\n}\n/**\r\n * Atomically updates a record with the result of updateFn, which gets\r\n * called with the current value. If newValue is undefined, the record is\r\n * deleted instead.\r\n * @return Updated value\r\n */\nfunction update(appConfig, updateFn) {\n  return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __awaiter */ \"e\"])(this, void 0, void 0, function () {\n    var key, db, tx, store, oldValue, newValue;\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __generator */ \"g\"])(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(appConfig);\n          return [4 /*yield*/, getDbPromise()];\n        case 1:\n          db = _a.sent();\n          tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n          store = tx.objectStore(OBJECT_STORE_NAME);\n          return [4 /*yield*/, store.get(key)];\n        case 2:\n          oldValue = _a.sent();\n          newValue = updateFn(oldValue);\n          if (!(newValue === undefined)) return [3 /*break*/, 4];\n          return [4 /*yield*/, store.delete(key)];\n        case 3:\n          _a.sent();\n          return [3 /*break*/, 6];\n        case 4:\n          return [4 /*yield*/, store.put(newValue, key)];\n        case 5:\n          _a.sent();\n          _a.label = 6;\n        case 6:\n          return [4 /*yield*/, tx.complete];\n        case 7:\n          _a.sent();\n          if (newValue && (!oldValue || oldValue.fid !== newValue.fid)) {\n            fidChanged(appConfig, newValue.fid);\n          }\n          return [2 /*return*/, newValue];\n      }\n    });\n  });\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Updates and returns the InstallationEntry from the database.\r\n * Also triggers a registration request if it is necessary and possible.\r\n */\nfunction getInstallationEntry(appConfig) {\n  return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __awaiter */ \"e\"])(this, void 0, void 0, function () {\n    var registrationPromise, installationEntry;\n    var _a;\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __generator */ \"g\"])(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4 /*yield*/, update(appConfig, function (oldEntry) {\n            var installationEntry = updateOrCreateInstallationEntry(oldEntry);\n            var entryWithPromise = triggerRegistrationIfNecessary(appConfig, installationEntry);\n            registrationPromise = entryWithPromise.registrationPromise;\n            return entryWithPromise.installationEntry;\n          })];\n        case 1:\n          installationEntry = _b.sent();\n          if (!(installationEntry.fid === INVALID_FID)) return [3 /*break*/, 3];\n          _a = {};\n          return [4 /*yield*/, registrationPromise];\n        case 2:\n          // FID generation failed. Waiting for the FID from the server.\n          return [2 /*return*/, (_a.installationEntry = _b.sent(), _a)];\n        case 3:\n          return [2 /*return*/, {\n            installationEntry: installationEntry,\n            registrationPromise: registrationPromise\n          }];\n      }\n    });\n  });\n}\n/**\r\n * Creates a new Installation Entry if one does not exist.\r\n * Also clears timed out pending requests.\r\n */\nfunction updateOrCreateInstallationEntry(oldEntry) {\n  var entry = oldEntry || {\n    fid: generateFid(),\n    registrationStatus: 0 /* NOT_STARTED */\n  };\n\n  return clearTimedOutRequest(entry);\n}\n/**\r\n * If the Firebase Installation is not registered yet, this will trigger the\r\n * registration and return an InProgressInstallationEntry.\r\n *\r\n * If registrationPromise does not exist, the installationEntry is guaranteed\r\n * to be registered.\r\n */\nfunction triggerRegistrationIfNecessary(appConfig, installationEntry) {\n  if (installationEntry.registrationStatus === 0 /* NOT_STARTED */) {\n    if (!navigator.onLine) {\n      // Registration required but app is offline.\n      var registrationPromiseWithError = Promise.reject(ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */));\n      return {\n        installationEntry: installationEntry,\n        registrationPromise: registrationPromiseWithError\n      };\n    }\n    // Try registering. Change status to IN_PROGRESS.\n    var inProgressEntry = {\n      fid: installationEntry.fid,\n      registrationStatus: 1 /* IN_PROGRESS */,\n      registrationTime: Date.now()\n    };\n    var registrationPromise = registerInstallation(appConfig, inProgressEntry);\n    return {\n      installationEntry: inProgressEntry,\n      registrationPromise: registrationPromise\n    };\n  } else if (installationEntry.registrationStatus === 1 /* IN_PROGRESS */) {\n    return {\n      installationEntry: installationEntry,\n      registrationPromise: waitUntilFidRegistration(appConfig)\n    };\n  } else {\n    return {\n      installationEntry: installationEntry\n    };\n  }\n}\n/** This will be executed only once for each new Firebase Installation. */\nfunction registerInstallation(appConfig, installationEntry) {\n  return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __awaiter */ \"e\"])(this, void 0, void 0, function () {\n    var registeredInstallationEntry, e_1;\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __generator */ \"g\"])(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          _a.trys.push([0, 2,, 7]);\n          return [4 /*yield*/, createInstallationRequest(appConfig, installationEntry)];\n        case 1:\n          registeredInstallationEntry = _a.sent();\n          return [2 /*return*/, set(appConfig, registeredInstallationEntry)];\n        case 2:\n          e_1 = _a.sent();\n          if (!(isServerError(e_1) && e_1.customData.serverCode === 409)) return [3 /*break*/, 4];\n          // Server returned a \"FID can not be used\" error.\n          // Generate a new ID next time.\n          return [4 /*yield*/, remove(appConfig)];\n        case 3:\n          // Server returned a \"FID can not be used\" error.\n          // Generate a new ID next time.\n          _a.sent();\n          return [3 /*break*/, 6];\n        case 4:\n          // Registration failed. Set FID as not registered.\n          return [4 /*yield*/, set(appConfig, {\n            fid: installationEntry.fid,\n            registrationStatus: 0 /* NOT_STARTED */\n          })];\n\n        case 5:\n          // Registration failed. Set FID as not registered.\n          _a.sent();\n          _a.label = 6;\n        case 6:\n          throw e_1;\n        case 7:\n          return [2 /*return*/];\n      }\n    });\n  });\n}\n/** Call if FID registration is pending in another request. */\nfunction waitUntilFidRegistration(appConfig) {\n  return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __awaiter */ \"e\"])(this, void 0, void 0, function () {\n    var entry, _a, installationEntry, registrationPromise;\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __generator */ \"g\"])(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4 /*yield*/, updateInstallationRequest(appConfig)];\n        case 1:\n          entry = _b.sent();\n          _b.label = 2;\n        case 2:\n          if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\n          // createInstallation request still in progress.\n          return [4 /*yield*/, sleep(100)];\n        case 3:\n          // createInstallation request still in progress.\n          _b.sent();\n          return [4 /*yield*/, updateInstallationRequest(appConfig)];\n        case 4:\n          entry = _b.sent();\n          return [3 /*break*/, 2];\n        case 5:\n          if (!(entry.registrationStatus === 0 /* NOT_STARTED */)) return [3 /*break*/, 7];\n          return [4 /*yield*/, getInstallationEntry(appConfig)];\n        case 6:\n          _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\n          if (registrationPromise) {\n            return [2 /*return*/, registrationPromise];\n          } else {\n            // if there is no registrationPromise, entry is registered.\n            return [2 /*return*/, installationEntry];\n          }\n        case 7:\n          return [2 /*return*/, entry];\n      }\n    });\n  });\n}\n/**\r\n * Called only if there is a CreateInstallation request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * CreateInstallation request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\nfunction updateInstallationRequest(appConfig) {\n  return update(appConfig, function (oldEntry) {\n    if (!oldEntry) {\n      throw ERROR_FACTORY.create(\"installation-not-found\" /* INSTALLATION_NOT_FOUND */);\n    }\n\n    return clearTimedOutRequest(oldEntry);\n  });\n}\nfunction clearTimedOutRequest(entry) {\n  if (hasInstallationRequestTimedOut(entry)) {\n    return {\n      fid: entry.fid,\n      registrationStatus: 0 /* NOT_STARTED */\n    };\n  }\n\n  return entry;\n}\nfunction hasInstallationRequestTimedOut(installationEntry) {\n  return installationEntry.registrationStatus === 1 /* IN_PROGRESS */ && installationEntry.registrationTime + PENDING_TIMEOUT_MS < Date.now();\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nfunction generateAuthTokenRequest(_a, installationEntry) {\n  var appConfig = _a.appConfig,\n    platformLoggerProvider = _a.platformLoggerProvider;\n  return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __awaiter */ \"e\"])(this, void 0, void 0, function () {\n    var endpoint, headers, platformLogger, body, request, response, responseValue, completedAuthToken;\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __generator */ \"g\"])(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          endpoint = getGenerateAuthTokenEndpoint(appConfig, installationEntry);\n          headers = getHeadersWithAuth(appConfig, installationEntry);\n          platformLogger = platformLoggerProvider.getImmediate({\n            optional: true\n          });\n          if (platformLogger) {\n            headers.append('x-firebase-client', platformLogger.getPlatformInfoString());\n          }\n          body = {\n            installation: {\n              sdkVersion: PACKAGE_VERSION\n            }\n          };\n          request = {\n            method: 'POST',\n            headers: headers,\n            body: JSON.stringify(body)\n          };\n          return [4 /*yield*/, retryIfServerError(function () {\n            return fetch(endpoint, request);\n          })];\n        case 1:\n          response = _b.sent();\n          if (!response.ok) return [3 /*break*/, 3];\n          return [4 /*yield*/, response.json()];\n        case 2:\n          responseValue = _b.sent();\n          completedAuthToken = extractAuthTokenInfoFromResponse(responseValue);\n          return [2 /*return*/, completedAuthToken];\n        case 3:\n          return [4 /*yield*/, getErrorFromResponse('Generate Auth Token', response)];\n        case 4:\n          throw _b.sent();\n      }\n    });\n  });\n}\nfunction getGenerateAuthTokenEndpoint(appConfig, _a) {\n  var fid = _a.fid;\n  return getInstallationsEndpoint(appConfig) + \"/\" + fid + \"/authTokens:generate\";\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Returns a valid authentication token for the installation. Generates a new\r\n * token if one doesn't exist, is expired or about to expire.\r\n *\r\n * Should only be called if the Firebase Installation is registered.\r\n */\nfunction refreshAuthToken(dependencies, forceRefresh) {\n  if (forceRefresh === void 0) {\n    forceRefresh = false;\n  }\n  return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __awaiter */ \"e\"])(this, void 0, void 0, function () {\n    var tokenPromise, entry, authToken, _a;\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __generator */ \"g\"])(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4 /*yield*/, update(dependencies.appConfig, function (oldEntry) {\n            if (!isEntryRegistered(oldEntry)) {\n              throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\n            }\n\n            var oldAuthToken = oldEntry.authToken;\n            if (!forceRefresh && isAuthTokenValid(oldAuthToken)) {\n              // There is a valid token in the DB.\n              return oldEntry;\n            } else if (oldAuthToken.requestStatus === 1 /* IN_PROGRESS */) {\n              // There already is a token request in progress.\n              tokenPromise = waitUntilAuthTokenRequest(dependencies, forceRefresh);\n              return oldEntry;\n            } else {\n              // No token or token expired.\n              if (!navigator.onLine) {\n                throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\n              }\n\n              var inProgressEntry = makeAuthTokenRequestInProgressEntry(oldEntry);\n              tokenPromise = fetchAuthTokenFromServer(dependencies, inProgressEntry);\n              return inProgressEntry;\n            }\n          })];\n        case 1:\n          entry = _b.sent();\n          if (!tokenPromise) return [3 /*break*/, 3];\n          return [4 /*yield*/, tokenPromise];\n        case 2:\n          _a = _b.sent();\n          return [3 /*break*/, 4];\n        case 3:\n          _a = entry.authToken;\n          _b.label = 4;\n        case 4:\n          authToken = _a;\n          return [2 /*return*/, authToken];\n      }\n    });\n  });\n}\n/**\r\n * Call only if FID is registered and Auth Token request is in progress.\r\n *\r\n * Waits until the current pending request finishes. If the request times out,\r\n * tries once in this thread as well.\r\n */\nfunction waitUntilAuthTokenRequest(dependencies, forceRefresh) {\n  return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __awaiter */ \"e\"])(this, void 0, void 0, function () {\n    var entry, authToken;\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __generator */ \"g\"])(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4 /*yield*/, updateAuthTokenRequest(dependencies.appConfig)];\n        case 1:\n          entry = _a.sent();\n          _a.label = 2;\n        case 2:\n          if (!(entry.authToken.requestStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\n          // generateAuthToken still in progress.\n          return [4 /*yield*/, sleep(100)];\n        case 3:\n          // generateAuthToken still in progress.\n          _a.sent();\n          return [4 /*yield*/, updateAuthTokenRequest(dependencies.appConfig)];\n        case 4:\n          entry = _a.sent();\n          return [3 /*break*/, 2];\n        case 5:\n          authToken = entry.authToken;\n          if (authToken.requestStatus === 0 /* NOT_STARTED */) {\n            // The request timed out or failed in a different call. Try again.\n            return [2 /*return*/, refreshAuthToken(dependencies, forceRefresh)];\n          } else {\n            return [2 /*return*/, authToken];\n          }\n      }\n    });\n  });\n}\n/**\r\n * Called only if there is a GenerateAuthToken request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * GenerateAuthToken request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\nfunction updateAuthTokenRequest(appConfig) {\n  return update(appConfig, function (oldEntry) {\n    if (!isEntryRegistered(oldEntry)) {\n      throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\n    }\n\n    var oldAuthToken = oldEntry.authToken;\n    if (hasAuthTokenRequestTimedOut(oldAuthToken)) {\n      return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __assign */ \"a\"])(Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __assign */ \"a\"])({}, oldEntry), {\n        authToken: {\n          requestStatus: 0 /* NOT_STARTED */\n        }\n      });\n    }\n\n    return oldEntry;\n  });\n}\nfunction fetchAuthTokenFromServer(dependencies, installationEntry) {\n  return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __awaiter */ \"e\"])(this, void 0, void 0, function () {\n    var authToken, updatedInstallationEntry, e_1, updatedInstallationEntry;\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __generator */ \"g\"])(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          _a.trys.push([0, 3,, 8]);\n          return [4 /*yield*/, generateAuthTokenRequest(dependencies, installationEntry)];\n        case 1:\n          authToken = _a.sent();\n          updatedInstallationEntry = Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __assign */ \"a\"])(Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __assign */ \"a\"])({}, installationEntry), {\n            authToken: authToken\n          });\n          return [4 /*yield*/, set(dependencies.appConfig, updatedInstallationEntry)];\n        case 2:\n          _a.sent();\n          return [2 /*return*/, authToken];\n        case 3:\n          e_1 = _a.sent();\n          if (!(isServerError(e_1) && (e_1.customData.serverCode === 401 || e_1.customData.serverCode === 404))) return [3 /*break*/, 5];\n          // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\n          // Generate a new ID next time.\n          return [4 /*yield*/, remove(dependencies.appConfig)];\n        case 4:\n          // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\n          // Generate a new ID next time.\n          _a.sent();\n          return [3 /*break*/, 7];\n        case 5:\n          updatedInstallationEntry = Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __assign */ \"a\"])(Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __assign */ \"a\"])({}, installationEntry), {\n            authToken: {\n              requestStatus: 0 /* NOT_STARTED */\n            }\n          });\n          return [4 /*yield*/, set(dependencies.appConfig, updatedInstallationEntry)];\n        case 6:\n          _a.sent();\n          _a.label = 7;\n        case 7:\n          throw e_1;\n        case 8:\n          return [2 /*return*/];\n      }\n    });\n  });\n}\n\nfunction isEntryRegistered(installationEntry) {\n  return installationEntry !== undefined && installationEntry.registrationStatus === 2 /* COMPLETED */;\n}\n\nfunction isAuthTokenValid(authToken) {\n  return authToken.requestStatus === 2 /* COMPLETED */ && !isAuthTokenExpired(authToken);\n}\nfunction isAuthTokenExpired(authToken) {\n  var now = Date.now();\n  return now < authToken.creationTime || authToken.creationTime + authToken.expiresIn < now + TOKEN_EXPIRATION_BUFFER;\n}\n/** Returns an updated InstallationEntry with an InProgressAuthToken. */\nfunction makeAuthTokenRequestInProgressEntry(oldEntry) {\n  var inProgressAuthToken = {\n    requestStatus: 1 /* IN_PROGRESS */,\n    requestTime: Date.now()\n  };\n  return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __assign */ \"a\"])(Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __assign */ \"a\"])({}, oldEntry), {\n    authToken: inProgressAuthToken\n  });\n}\nfunction hasAuthTokenRequestTimedOut(authToken) {\n  return authToken.requestStatus === 1 /* IN_PROGRESS */ && authToken.requestTime + PENDING_TIMEOUT_MS < Date.now();\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nfunction _getId(dependencies) {\n  return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __awaiter */ \"e\"])(this, void 0, void 0, function () {\n    var _a, installationEntry, registrationPromise;\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __generator */ \"g\"])(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4 /*yield*/, getInstallationEntry(dependencies.appConfig)];\n        case 1:\n          _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\n          if (registrationPromise) {\n            registrationPromise.catch(console.error);\n          } else {\n            // If the installation is already registered, update the authentication\n            // token if needed.\n            refreshAuthToken(dependencies).catch(console.error);\n          }\n          return [2 /*return*/, installationEntry.fid];\n      }\n    });\n  });\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nfunction _getToken(dependencies, forceRefresh) {\n  if (forceRefresh === void 0) {\n    forceRefresh = false;\n  }\n  return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __awaiter */ \"e\"])(this, void 0, void 0, function () {\n    var authToken;\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __generator */ \"g\"])(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4 /*yield*/, completeInstallationRegistration(dependencies.appConfig)];\n        case 1:\n          _a.sent();\n          return [4 /*yield*/, refreshAuthToken(dependencies, forceRefresh)];\n        case 2:\n          authToken = _a.sent();\n          return [2 /*return*/, authToken.token];\n      }\n    });\n  });\n}\nfunction completeInstallationRegistration(appConfig) {\n  return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __awaiter */ \"e\"])(this, void 0, void 0, function () {\n    var registrationPromise;\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __generator */ \"g\"])(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4 /*yield*/, getInstallationEntry(appConfig)];\n        case 1:\n          registrationPromise = _a.sent().registrationPromise;\n          if (!registrationPromise) return [3 /*break*/, 3];\n          // A createInstallation request is in progress. Wait until it finishes.\n          return [4 /*yield*/, registrationPromise];\n        case 2:\n          // A createInstallation request is in progress. Wait until it finishes.\n          _a.sent();\n          _a.label = 3;\n        case 3:\n          return [2 /*return*/];\n      }\n    });\n  });\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nfunction deleteInstallationRequest(appConfig, installationEntry) {\n  return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __awaiter */ \"e\"])(this, void 0, void 0, function () {\n    var endpoint, headers, request, response;\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __generator */ \"g\"])(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          endpoint = getDeleteEndpoint(appConfig, installationEntry);\n          headers = getHeadersWithAuth(appConfig, installationEntry);\n          request = {\n            method: 'DELETE',\n            headers: headers\n          };\n          return [4 /*yield*/, retryIfServerError(function () {\n            return fetch(endpoint, request);\n          })];\n        case 1:\n          response = _a.sent();\n          if (!!response.ok) return [3 /*break*/, 3];\n          return [4 /*yield*/, getErrorFromResponse('Delete Installation', response)];\n        case 2:\n          throw _a.sent();\n        case 3:\n          return [2 /*return*/];\n      }\n    });\n  });\n}\n\nfunction getDeleteEndpoint(appConfig, _a) {\n  var fid = _a.fid;\n  return getInstallationsEndpoint(appConfig) + \"/\" + fid;\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nfunction deleteInstallation(dependencies) {\n  return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __awaiter */ \"e\"])(this, void 0, void 0, function () {\n    var appConfig, entry;\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __generator */ \"g\"])(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          appConfig = dependencies.appConfig;\n          return [4 /*yield*/, update(appConfig, function (oldEntry) {\n            if (oldEntry && oldEntry.registrationStatus === 0 /* NOT_STARTED */) {\n              // Delete the unregistered entry without sending a deleteInstallation request.\n              return undefined;\n            }\n            return oldEntry;\n          })];\n        case 1:\n          entry = _a.sent();\n          if (!entry) return [3 /*break*/, 6];\n          if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 2];\n          // Can't delete while trying to register.\n          throw ERROR_FACTORY.create(\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */);\n        case 2:\n          if (!(entry.registrationStatus === 2 /* COMPLETED */)) return [3 /*break*/, 6];\n          if (!!navigator.onLine) return [3 /*break*/, 3];\n          throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\n        case 3:\n          return [4 /*yield*/, deleteInstallationRequest(appConfig, entry)];\n        case 4:\n          _a.sent();\n          return [4 /*yield*/, remove(appConfig)];\n        case 5:\n          _a.sent();\n          _a.label = 6;\n        case 6:\n          return [2 /*return*/];\n      }\n    });\n  });\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Sets a new callback that will get called when Installation ID changes.\r\n * Returns an unsubscribe function that will remove the callback when called.\r\n */\nfunction _onIdChange(_a, callback) {\n  var appConfig = _a.appConfig;\n  addCallback(appConfig, callback);\n  return function () {\n    removeCallback(appConfig, callback);\n  };\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nfunction extractAppConfig(app) {\n  var e_1, _a;\n  if (!app || !app.options) {\n    throw getMissingValueError('App Configuration');\n  }\n  if (!app.name) {\n    throw getMissingValueError('App Name');\n  }\n  // Required app config keys\n  var configKeys = ['projectId', 'apiKey', 'appId'];\n  try {\n    for (var configKeys_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_2__[/* __values */ \"j\"])(configKeys), configKeys_1_1 = configKeys_1.next(); !configKeys_1_1.done; configKeys_1_1 = configKeys_1.next()) {\n      var keyName = configKeys_1_1.value;\n      if (!app.options[keyName]) {\n        throw getMissingValueError(keyName);\n      }\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (configKeys_1_1 && !configKeys_1_1.done && (_a = configKeys_1.return)) _a.call(configKeys_1);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n  return {\n    appName: app.name,\n    projectId: app.options.projectId,\n    apiKey: app.options.apiKey,\n    appId: app.options.appId\n  };\n}\nfunction getMissingValueError(valueName) {\n  return ERROR_FACTORY.create(\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */, {\n    valueName: valueName\n  });\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nfunction registerInstallations(instance) {\n  var installationsName = 'installations';\n  instance.INTERNAL.registerComponent(new _firebase_component__WEBPACK_IMPORTED_MODULE_1__[/* Component */ \"a\"](installationsName, function (container) {\n    var app = container.getProvider('app').getImmediate();\n    // Throws if app isn't configured properly.\n    var appConfig = extractAppConfig(app);\n    var platformLoggerProvider = container.getProvider('platform-logger');\n    var dependencies = {\n      appConfig: appConfig,\n      platformLoggerProvider: platformLoggerProvider\n    };\n    var installations = {\n      app: app,\n      getId: function getId() {\n        return _getId(dependencies);\n      },\n      getToken: function getToken(forceRefresh) {\n        return _getToken(dependencies, forceRefresh);\n      },\n      delete: function _delete() {\n        return deleteInstallation(dependencies);\n      },\n      onIdChange: function onIdChange(callback) {\n        return _onIdChange(dependencies, callback);\n      }\n    };\n    return installations;\n  }, \"PUBLIC\" /* PUBLIC */));\n  instance.registerVersion(name, version);\n}\nregisterInstallations(_firebase_app__WEBPACK_IMPORTED_MODULE_0__[/* default */ \"a\"]);\n\n\n/***/ }),\n\n/***/ 242:\n/***/ (function(module, exports, __webpack_require__) {\n\n(function (global, factory) {\n   true ? factory(exports) : undefined;\n})(this, function (exports) {\n  'use strict';\n\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n  function promisifyRequest(request) {\n    return new Promise(function (resolve, reject) {\n      request.onsuccess = function () {\n        resolve(request.result);\n      };\n      request.onerror = function () {\n        reject(request.error);\n      };\n    });\n  }\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function (resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n    p.request = request;\n    return p;\n  }\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function (value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function (prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function get() {\n          return this[targetProp][prop];\n        },\n        set: function set(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function (prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function () {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function (prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function () {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function (prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function () {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n  function Index(index) {\n    this._index = index;\n  }\n  proxyProperties(Index, '_index', ['name', 'keyPath', 'multiEntry', 'unique']);\n  proxyRequestMethods(Index, '_index', IDBIndex, ['get', 'getKey', 'getAll', 'getAllKeys', 'count']);\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, ['openCursor', 'openKeyCursor']);\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n  proxyProperties(Cursor, '_cursor', ['direction', 'key', 'primaryKey', 'value']);\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, ['update', 'delete']);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function (methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function () {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function () {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function (value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n  function ObjectStore(store) {\n    this._store = store;\n  }\n  ObjectStore.prototype.createIndex = function () {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n  ObjectStore.prototype.index = function () {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n  proxyProperties(ObjectStore, '_store', ['name', 'keyPath', 'indexNames', 'autoIncrement']);\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, ['put', 'add', 'delete', 'clear', 'get', 'getAll', 'getKey', 'getAllKeys', 'count']);\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, ['openCursor', 'openKeyCursor']);\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, ['deleteIndex']);\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function (resolve, reject) {\n      idbTransaction.oncomplete = function () {\n        resolve();\n      };\n      idbTransaction.onerror = function () {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function () {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n  Transaction.prototype.objectStore = function () {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n  proxyProperties(Transaction, '_tx', ['objectStoreNames', 'mode']);\n  proxyMethods(Transaction, '_tx', IDBTransaction, ['abort']);\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n  UpgradeDB.prototype.createObjectStore = function () {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n  proxyProperties(UpgradeDB, '_db', ['name', 'version', 'objectStoreNames']);\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, ['deleteObjectStore', 'close']);\n  function DB(db) {\n    this._db = db;\n  }\n  DB.prototype.transaction = function () {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n  proxyProperties(DB, '_db', ['name', 'version', 'objectStoreNames']);\n  proxyMethods(DB, '_db', IDBDatabase, ['close']);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function (funcName) {\n    [ObjectStore, Index].forEach(function (Constructor) {\n      // Don't create iterateKeyCursor if openKeyCursor doesn't exist.\n      if (!(funcName in Constructor.prototype)) return;\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function () {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function () {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function (Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function (query, count) {\n      var instance = this;\n      var items = [];\n      return new Promise(function (resolve) {\n        instance.iterateCursor(query, function (cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n  function openDb(name, version, upgradeCallback) {\n    var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n    var request = p.request;\n    if (request) {\n      request.onupgradeneeded = function (event) {\n        if (upgradeCallback) {\n          upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n        }\n      };\n    }\n    return p.then(function (db) {\n      return new DB(db);\n    });\n  }\n  function deleteDb(name) {\n    return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n  }\n  exports.openDb = openDb;\n  exports.deleteDb = deleteDb;\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n});\n\n/***/ })\n\n}]);","inputSourceMap":{"version":3,"sources":["../src/util/constants.ts","../src/util/errors.ts","../src/api/common.ts","../src/api/create-installation-request.ts","../src/util/sleep.ts","../src/helpers/buffer-to-base64-url-safe.ts","../src/helpers/generate-fid.ts","../src/util/get-key.ts","../src/helpers/fid-changed.ts","../src/helpers/idb-manager.ts","../src/helpers/get-installation-entry.ts","../src/api/generate-auth-token-request.ts","../src/helpers/refresh-auth-token.ts","../src/functions/get-id.ts","../src/functions/get-token.ts","../src/api/delete-installation-request.ts","../src/functions/delete-installation.ts","../src/functions/on-id-change.ts","../src/helpers/extract-app-config.ts","../src/index.ts","C:/Users/Andrew Krause/react-car-inv-6/node_modules/idb/build/idb.js"],"names":["global","factory","exports","toArray","arr","Array","prototype","slice","call","promisifyRequest","request","Promise","resolve","reject","onsuccess","result","onerror","error","promisifyRequestCall","obj","method","args","p","apply","then","promisifyCursorRequestCall","value","Cursor","proxyProperties","ProxyClass","targetProp","properties","forEach","prop","Object","defineProperty","get","set","val","proxyRequestMethods","Constructor","arguments","proxyMethods","proxyCursorRequestMethods","Index","index","_index","IDBIndex","cursor","_cursor","_request","IDBCursor","methodName","ObjectStore","store","_store","createIndex","IDBObjectStore","Transaction","idbTransaction","_tx","complete","oncomplete","onabort","objectStore","IDBTransaction","UpgradeDB","db","oldVersion","transaction","_db","createObjectStore","IDBDatabase","DB","funcName","replace","callback","length","nativeObject","getAll","query","count","instance","items","iterateCursor","push","undefined","continue","openDb","name","version","upgradeCallback","indexedDB","onupgradeneeded","event","deleteDb"],"mappings":"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","file":"x","sourcesContent":["/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { version } from '../../package.json';\n\nexport const PENDING_TIMEOUT_MS = 10000;\n\nexport const PACKAGE_VERSION = `w:${version}`;\nexport const INTERNAL_AUTH_VERSION = 'FIS_v2';\n\nexport const INSTALLATIONS_API_URL =\n  'https://firebaseinstallations.googleapis.com/v1';\n\nexport const TOKEN_EXPIRATION_BUFFER = 60 * 60 * 1000; // One hour\n\nexport const SERVICE = 'installations';\nexport const SERVICE_NAME = 'Installations';\n","/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ErrorFactory, FirebaseError } from '@firebase/util';\nimport { SERVICE, SERVICE_NAME } from './constants';\n\nexport const enum ErrorCode {\n  MISSING_APP_CONFIG_VALUES = 'missing-app-config-values',\n  NOT_REGISTERED = 'not-registered',\n  INSTALLATION_NOT_FOUND = 'installation-not-found',\n  REQUEST_FAILED = 'request-failed',\n  APP_OFFLINE = 'app-offline',\n  DELETE_PENDING_REGISTRATION = 'delete-pending-registration'\n}\n\nconst ERROR_DESCRIPTION_MAP: { readonly [key in ErrorCode]: string } = {\n  [ErrorCode.MISSING_APP_CONFIG_VALUES]:\n    'Missing App configuration value: \"{$valueName}\"',\n  [ErrorCode.NOT_REGISTERED]: 'Firebase Installation is not registered.',\n  [ErrorCode.INSTALLATION_NOT_FOUND]: 'Firebase Installation not found.',\n  [ErrorCode.REQUEST_FAILED]:\n    '{$requestName} request failed with error \"{$serverCode} {$serverStatus}: {$serverMessage}\"',\n  [ErrorCode.APP_OFFLINE]: 'Could not process request. Application offline.',\n  [ErrorCode.DELETE_PENDING_REGISTRATION]:\n    \"Can't delete installation while there is a pending registration request.\"\n};\n\ninterface ErrorParams {\n  [ErrorCode.MISSING_APP_CONFIG_VALUES]: {\n    valueName: string;\n  };\n  [ErrorCode.REQUEST_FAILED]: {\n    requestName: string;\n    [index: string]: string | number; // to make Typescript 3.8 happy\n  } & ServerErrorData;\n}\n\nexport const ERROR_FACTORY = new ErrorFactory<ErrorCode, ErrorParams>(\n  SERVICE,\n  SERVICE_NAME,\n  ERROR_DESCRIPTION_MAP\n);\n\nexport interface ServerErrorData {\n  serverCode: number;\n  serverMessage: string;\n  serverStatus: string;\n}\n\nexport type ServerError = FirebaseError & { customData: ServerErrorData };\n\n/** Returns true if error is a FirebaseError that is based on an error from the server. */\nexport function isServerError(error: unknown): error is ServerError {\n  return (\n    error instanceof FirebaseError &&\n    error.code.includes(ErrorCode.REQUEST_FAILED)\n  );\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FirebaseError } from '@firebase/util';\nimport { GenerateAuthTokenResponse } from '../interfaces/api-response';\nimport { AppConfig } from '../interfaces/app-config';\nimport {\n  CompletedAuthToken,\n  RegisteredInstallationEntry,\n  RequestStatus\n} from '../interfaces/installation-entry';\nimport {\n  INSTALLATIONS_API_URL,\n  INTERNAL_AUTH_VERSION\n} from '../util/constants';\nimport { ERROR_FACTORY, ErrorCode } from '../util/errors';\n\nexport function getInstallationsEndpoint({ projectId }: AppConfig): string {\n  return `${INSTALLATIONS_API_URL}/projects/${projectId}/installations`;\n}\n\nexport function extractAuthTokenInfoFromResponse(\n  response: GenerateAuthTokenResponse\n): CompletedAuthToken {\n  return {\n    token: response.token,\n    requestStatus: RequestStatus.COMPLETED,\n    expiresIn: getExpiresInFromResponseExpiresIn(response.expiresIn),\n    creationTime: Date.now()\n  };\n}\n\nexport async function getErrorFromResponse(\n  requestName: string,\n  response: Response\n): Promise<FirebaseError> {\n  const responseJson: ErrorResponse = await response.json();\n  const errorData = responseJson.error;\n  return ERROR_FACTORY.create(ErrorCode.REQUEST_FAILED, {\n    requestName,\n    serverCode: errorData.code,\n    serverMessage: errorData.message,\n    serverStatus: errorData.status\n  });\n}\n\nexport function getHeaders({ apiKey }: AppConfig): Headers {\n  return new Headers({\n    'Content-Type': 'application/json',\n    Accept: 'application/json',\n    'x-goog-api-key': apiKey\n  });\n}\n\nexport function getHeadersWithAuth(\n  appConfig: AppConfig,\n  { refreshToken }: RegisteredInstallationEntry\n): Headers {\n  const headers = getHeaders(appConfig);\n  headers.append('Authorization', getAuthorizationHeader(refreshToken));\n  return headers;\n}\n\nexport interface ErrorResponse {\n  error: {\n    code: number;\n    message: string;\n    status: string;\n  };\n}\n\n/**\n * Calls the passed in fetch wrapper and returns the response.\n * If the returned response has a status of 5xx, re-runs the function once and\n * returns the response.\n */\nexport async function retryIfServerError(\n  fn: () => Promise<Response>\n): Promise<Response> {\n  const result = await fn();\n\n  if (result.status >= 500 && result.status < 600) {\n    // Internal Server Error. Retry request.\n    return fn();\n  }\n\n  return result;\n}\n\nfunction getExpiresInFromResponseExpiresIn(responseExpiresIn: string): number {\n  // This works because the server will never respond with fractions of a second.\n  return Number(responseExpiresIn.replace('s', '000'));\n}\n\nfunction getAuthorizationHeader(refreshToken: string): string {\n  return `${INTERNAL_AUTH_VERSION} ${refreshToken}`;\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CreateInstallationResponse } from '../interfaces/api-response';\nimport { AppConfig } from '../interfaces/app-config';\nimport {\n  InProgressInstallationEntry,\n  RegisteredInstallationEntry,\n  RequestStatus\n} from '../interfaces/installation-entry';\nimport { INTERNAL_AUTH_VERSION, PACKAGE_VERSION } from '../util/constants';\nimport {\n  extractAuthTokenInfoFromResponse,\n  getErrorFromResponse,\n  getHeaders,\n  getInstallationsEndpoint,\n  retryIfServerError\n} from './common';\n\nexport async function createInstallationRequest(\n  appConfig: AppConfig,\n  { fid }: InProgressInstallationEntry\n): Promise<RegisteredInstallationEntry> {\n  const endpoint = getInstallationsEndpoint(appConfig);\n\n  const headers = getHeaders(appConfig);\n  const body = {\n    fid,\n    authVersion: INTERNAL_AUTH_VERSION,\n    appId: appConfig.appId,\n    sdkVersion: PACKAGE_VERSION\n  };\n\n  const request: RequestInit = {\n    method: 'POST',\n    headers,\n    body: JSON.stringify(body)\n  };\n\n  const response = await retryIfServerError(() => fetch(endpoint, request));\n  if (response.ok) {\n    const responseValue: CreateInstallationResponse = await response.json();\n    const registeredInstallationEntry: RegisteredInstallationEntry = {\n      fid: responseValue.fid || fid,\n      registrationStatus: RequestStatus.COMPLETED,\n      refreshToken: responseValue.refreshToken,\n      authToken: extractAuthTokenInfoFromResponse(responseValue.authToken)\n    };\n    return registeredInstallationEntry;\n  } else {\n    throw await getErrorFromResponse('Create Installation', response);\n  }\n}\n","/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** Returns a promise that resolves after given time passes. */\nexport function sleep(ms: number): Promise<void> {\n  return new Promise<void>(resolve => {\n    setTimeout(resolve, ms);\n  });\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport function bufferToBase64UrlSafe(array: Uint8Array): string {\n  const b64 = btoa(String.fromCharCode(...array));\n  return b64.replace(/\\+/g, '-').replace(/\\//g, '_');\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { bufferToBase64UrlSafe } from './buffer-to-base64-url-safe';\n\nexport const VALID_FID_PATTERN = /^[cdef][\\w-]{21}$/;\nexport const INVALID_FID = '';\n\n/**\n * Generates a new FID using random values from Web Crypto API.\n * Returns an empty string if FID generation fails for any reason.\n */\nexport function generateFid(): string {\n  try {\n    // A valid FID has exactly 22 base64 characters, which is 132 bits, or 16.5\n    // bytes. our implementation generates a 17 byte array instead.\n    const fidByteArray = new Uint8Array(17);\n    const crypto =\n      self.crypto || ((self as unknown) as { msCrypto: Crypto }).msCrypto;\n    crypto.getRandomValues(fidByteArray);\n\n    // Replace the first 4 random bits with the constant FID header of 0b0111.\n    fidByteArray[0] = 0b01110000 + (fidByteArray[0] % 0b00010000);\n\n    const fid = encode(fidByteArray);\n\n    return VALID_FID_PATTERN.test(fid) ? fid : INVALID_FID;\n  } catch {\n    // FID generation errored\n    return INVALID_FID;\n  }\n}\n\n/** Converts a FID Uint8Array to a base64 string representation. */\nfunction encode(fidByteArray: Uint8Array): string {\n  const b64String = bufferToBase64UrlSafe(fidByteArray);\n\n  // Remove the 23rd character that was added because of the extra 4 bits at the\n  // end of our 17 byte array, and the '=' padding.\n  return b64String.substr(0, 22);\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AppConfig } from '../interfaces/app-config';\n\n/** Returns a string key that can be used to identify the app. */\nexport function getKey(appConfig: AppConfig): string {\n  return `${appConfig.appName}!${appConfig.appId}`;\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { getKey } from '../util/get-key';\nimport { AppConfig } from '../interfaces/app-config';\nimport { IdChangeCallbackFn } from '../functions';\n\nconst fidChangeCallbacks: Map<string, Set<IdChangeCallbackFn>> = new Map();\n\n/**\n * Calls the onIdChange callbacks with the new FID value, and broadcasts the\n * change to other tabs.\n */\nexport function fidChanged(appConfig: AppConfig, fid: string): void {\n  const key = getKey(appConfig);\n\n  callFidChangeCallbacks(key, fid);\n  broadcastFidChange(key, fid);\n}\n\nexport function addCallback(\n  appConfig: AppConfig,\n  callback: IdChangeCallbackFn\n): void {\n  // Open the broadcast channel if it's not already open,\n  // to be able to listen to change events from other tabs.\n  getBroadcastChannel();\n\n  const key = getKey(appConfig);\n\n  let callbackSet = fidChangeCallbacks.get(key);\n  if (!callbackSet) {\n    callbackSet = new Set();\n    fidChangeCallbacks.set(key, callbackSet);\n  }\n  callbackSet.add(callback);\n}\n\nexport function removeCallback(\n  appConfig: AppConfig,\n  callback: IdChangeCallbackFn\n): void {\n  const key = getKey(appConfig);\n\n  const callbackSet = fidChangeCallbacks.get(key);\n\n  if (!callbackSet) {\n    return;\n  }\n\n  callbackSet.delete(callback);\n  if (callbackSet.size === 0) {\n    fidChangeCallbacks.delete(key);\n  }\n\n  // Close broadcast channel if there are no more callbacks.\n  closeBroadcastChannel();\n}\n\nfunction callFidChangeCallbacks(key: string, fid: string): void {\n  const callbacks = fidChangeCallbacks.get(key);\n  if (!callbacks) {\n    return;\n  }\n\n  for (const callback of callbacks) {\n    callback(fid);\n  }\n}\n\nfunction broadcastFidChange(key: string, fid: string): void {\n  const channel = getBroadcastChannel();\n  if (channel) {\n    channel.postMessage({ key, fid });\n  }\n  closeBroadcastChannel();\n}\n\nlet broadcastChannel: BroadcastChannel | null = null;\n/** Opens and returns a BroadcastChannel if it is supported by the browser. */\nfunction getBroadcastChannel(): BroadcastChannel | null {\n  if (!broadcastChannel && 'BroadcastChannel' in self) {\n    broadcastChannel = new BroadcastChannel('[Firebase] FID Change');\n    broadcastChannel.onmessage = e => {\n      callFidChangeCallbacks(e.data.key, e.data.fid);\n    };\n  }\n  return broadcastChannel;\n}\n\nfunction closeBroadcastChannel(): void {\n  if (fidChangeCallbacks.size === 0 && broadcastChannel) {\n    broadcastChannel.close();\n    broadcastChannel = null;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DB, openDb } from 'idb';\nimport { AppConfig } from '../interfaces/app-config';\nimport { InstallationEntry } from '../interfaces/installation-entry';\nimport { getKey } from '../util/get-key';\nimport { fidChanged } from './fid-changed';\n\nconst DATABASE_NAME = 'firebase-installations-database';\nconst DATABASE_VERSION = 1;\nconst OBJECT_STORE_NAME = 'firebase-installations-store';\n\nlet dbPromise: Promise<DB> | null = null;\nfunction getDbPromise(): Promise<DB> {\n  if (!dbPromise) {\n    dbPromise = openDb(DATABASE_NAME, DATABASE_VERSION, upgradeDB => {\n      // We don't use 'break' in this switch statement, the fall-through\n      // behavior is what we want, because if there are multiple versions between\n      // the old version and the current version, we want ALL the migrations\n      // that correspond to those versions to run, not only the last one.\n      // eslint-disable-next-line default-case\n      switch (upgradeDB.oldVersion) {\n        case 0:\n          upgradeDB.createObjectStore(OBJECT_STORE_NAME);\n      }\n    });\n  }\n  return dbPromise;\n}\n\n/** Gets record(s) from the objectStore that match the given key. */\nexport async function get(\n  appConfig: AppConfig\n): Promise<InstallationEntry | undefined> {\n  const key = getKey(appConfig);\n  const db = await getDbPromise();\n  return db\n    .transaction(OBJECT_STORE_NAME)\n    .objectStore(OBJECT_STORE_NAME)\n    .get(key);\n}\n\n/** Assigns or overwrites the record for the given key with the given value. */\nexport async function set<ValueType extends InstallationEntry>(\n  appConfig: AppConfig,\n  value: ValueType\n): Promise<ValueType> {\n  const key = getKey(appConfig);\n  const db = await getDbPromise();\n  const tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n  const objectStore = tx.objectStore(OBJECT_STORE_NAME);\n  const oldValue = await objectStore.get(key);\n  await objectStore.put(value, key);\n  await tx.complete;\n\n  if (!oldValue || oldValue.fid !== value.fid) {\n    fidChanged(appConfig, value.fid);\n  }\n\n  return value;\n}\n\n/** Removes record(s) from the objectStore that match the given key. */\nexport async function remove(appConfig: AppConfig): Promise<void> {\n  const key = getKey(appConfig);\n  const db = await getDbPromise();\n  const tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n  await tx.objectStore(OBJECT_STORE_NAME).delete(key);\n  await tx.complete;\n}\n\n/**\n * Atomically updates a record with the result of updateFn, which gets\n * called with the current value. If newValue is undefined, the record is\n * deleted instead.\n * @return Updated value\n */\nexport async function update<ValueType extends InstallationEntry | undefined>(\n  appConfig: AppConfig,\n  updateFn: (previousValue: InstallationEntry | undefined) => ValueType\n): Promise<ValueType> {\n  const key = getKey(appConfig);\n  const db = await getDbPromise();\n  const tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n  const store = tx.objectStore(OBJECT_STORE_NAME);\n  const oldValue: InstallationEntry | undefined = await store.get(key);\n  const newValue = updateFn(oldValue);\n\n  if (newValue === undefined) {\n    await store.delete(key);\n  } else {\n    await store.put(newValue, key);\n  }\n  await tx.complete;\n\n  if (newValue && (!oldValue || oldValue.fid !== newValue.fid)) {\n    fidChanged(appConfig, newValue.fid);\n  }\n\n  return newValue;\n}\n\nexport async function clear(): Promise<void> {\n  const db = await getDbPromise();\n  const tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n  await tx.objectStore(OBJECT_STORE_NAME).clear();\n  await tx.complete;\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createInstallationRequest } from '../api/create-installation-request';\nimport { AppConfig } from '../interfaces/app-config';\nimport {\n  InProgressInstallationEntry,\n  InstallationEntry,\n  RegisteredInstallationEntry,\n  RequestStatus\n} from '../interfaces/installation-entry';\nimport { PENDING_TIMEOUT_MS } from '../util/constants';\nimport { ERROR_FACTORY, ErrorCode, isServerError } from '../util/errors';\nimport { sleep } from '../util/sleep';\nimport { generateFid, INVALID_FID } from './generate-fid';\nimport { remove, set, update } from './idb-manager';\n\nexport interface InstallationEntryWithRegistrationPromise {\n  installationEntry: InstallationEntry;\n  /** Exist iff the installationEntry is not registered. */\n  registrationPromise?: Promise<RegisteredInstallationEntry>;\n}\n\n/**\n * Updates and returns the InstallationEntry from the database.\n * Also triggers a registration request if it is necessary and possible.\n */\nexport async function getInstallationEntry(\n  appConfig: AppConfig\n): Promise<InstallationEntryWithRegistrationPromise> {\n  let registrationPromise: Promise<RegisteredInstallationEntry> | undefined;\n\n  const installationEntry = await update(appConfig, oldEntry => {\n    const installationEntry = updateOrCreateInstallationEntry(oldEntry);\n    const entryWithPromise = triggerRegistrationIfNecessary(\n      appConfig,\n      installationEntry\n    );\n    registrationPromise = entryWithPromise.registrationPromise;\n    return entryWithPromise.installationEntry;\n  });\n\n  if (installationEntry.fid === INVALID_FID) {\n    // FID generation failed. Waiting for the FID from the server.\n    return { installationEntry: await registrationPromise! };\n  }\n\n  return {\n    installationEntry,\n    registrationPromise\n  };\n}\n\n/**\n * Creates a new Installation Entry if one does not exist.\n * Also clears timed out pending requests.\n */\nfunction updateOrCreateInstallationEntry(\n  oldEntry: InstallationEntry | undefined\n): InstallationEntry {\n  const entry: InstallationEntry = oldEntry || {\n    fid: generateFid(),\n    registrationStatus: RequestStatus.NOT_STARTED\n  };\n\n  return clearTimedOutRequest(entry);\n}\n\n/**\n * If the Firebase Installation is not registered yet, this will trigger the\n * registration and return an InProgressInstallationEntry.\n *\n * If registrationPromise does not exist, the installationEntry is guaranteed\n * to be registered.\n */\nfunction triggerRegistrationIfNecessary(\n  appConfig: AppConfig,\n  installationEntry: InstallationEntry\n): InstallationEntryWithRegistrationPromise {\n  if (installationEntry.registrationStatus === RequestStatus.NOT_STARTED) {\n    if (!navigator.onLine) {\n      // Registration required but app is offline.\n      const registrationPromiseWithError = Promise.reject(\n        ERROR_FACTORY.create(ErrorCode.APP_OFFLINE)\n      );\n      return {\n        installationEntry,\n        registrationPromise: registrationPromiseWithError\n      };\n    }\n\n    // Try registering. Change status to IN_PROGRESS.\n    const inProgressEntry: InProgressInstallationEntry = {\n      fid: installationEntry.fid,\n      registrationStatus: RequestStatus.IN_PROGRESS,\n      registrationTime: Date.now()\n    };\n    const registrationPromise = registerInstallation(\n      appConfig,\n      inProgressEntry\n    );\n    return { installationEntry: inProgressEntry, registrationPromise };\n  } else if (\n    installationEntry.registrationStatus === RequestStatus.IN_PROGRESS\n  ) {\n    return {\n      installationEntry,\n      registrationPromise: waitUntilFidRegistration(appConfig)\n    };\n  } else {\n    return { installationEntry };\n  }\n}\n\n/** This will be executed only once for each new Firebase Installation. */\nasync function registerInstallation(\n  appConfig: AppConfig,\n  installationEntry: InProgressInstallationEntry\n): Promise<RegisteredInstallationEntry> {\n  try {\n    const registeredInstallationEntry = await createInstallationRequest(\n      appConfig,\n      installationEntry\n    );\n    return set(appConfig, registeredInstallationEntry);\n  } catch (e) {\n    if (isServerError(e) && e.customData.serverCode === 409) {\n      // Server returned a \"FID can not be used\" error.\n      // Generate a new ID next time.\n      await remove(appConfig);\n    } else {\n      // Registration failed. Set FID as not registered.\n      await set(appConfig, {\n        fid: installationEntry.fid,\n        registrationStatus: RequestStatus.NOT_STARTED\n      });\n    }\n    throw e;\n  }\n}\n\n/** Call if FID registration is pending in another request. */\nasync function waitUntilFidRegistration(\n  appConfig: AppConfig\n): Promise<RegisteredInstallationEntry> {\n  // Unfortunately, there is no way of reliably observing when a value in\n  // IndexedDB changes (yet, see https://github.com/WICG/indexed-db-observers),\n  // so we need to poll.\n\n  let entry: InstallationEntry = await updateInstallationRequest(appConfig);\n  while (entry.registrationStatus === RequestStatus.IN_PROGRESS) {\n    // createInstallation request still in progress.\n    await sleep(100);\n\n    entry = await updateInstallationRequest(appConfig);\n  }\n\n  if (entry.registrationStatus === RequestStatus.NOT_STARTED) {\n    // The request timed out or failed in a different call. Try again.\n    const {\n      installationEntry,\n      registrationPromise\n    } = await getInstallationEntry(appConfig);\n\n    if (registrationPromise) {\n      return registrationPromise;\n    } else {\n      // if there is no registrationPromise, entry is registered.\n      return installationEntry as RegisteredInstallationEntry;\n    }\n  }\n\n  return entry;\n}\n\n/**\n * Called only if there is a CreateInstallation request in progress.\n *\n * Updates the InstallationEntry in the DB based on the status of the\n * CreateInstallation request.\n *\n * Returns the updated InstallationEntry.\n */\nfunction updateInstallationRequest(\n  appConfig: AppConfig\n): Promise<InstallationEntry> {\n  return update(appConfig, oldEntry => {\n    if (!oldEntry) {\n      throw ERROR_FACTORY.create(ErrorCode.INSTALLATION_NOT_FOUND);\n    }\n    return clearTimedOutRequest(oldEntry);\n  });\n}\n\nfunction clearTimedOutRequest(entry: InstallationEntry): InstallationEntry {\n  if (hasInstallationRequestTimedOut(entry)) {\n    return {\n      fid: entry.fid,\n      registrationStatus: RequestStatus.NOT_STARTED\n    };\n  }\n\n  return entry;\n}\n\nfunction hasInstallationRequestTimedOut(\n  installationEntry: InstallationEntry\n): boolean {\n  return (\n    installationEntry.registrationStatus === RequestStatus.IN_PROGRESS &&\n    installationEntry.registrationTime + PENDING_TIMEOUT_MS < Date.now()\n  );\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { GenerateAuthTokenResponse } from '../interfaces/api-response';\nimport { AppConfig } from '../interfaces/app-config';\nimport { FirebaseDependencies } from '../interfaces/firebase-dependencies';\nimport {\n  CompletedAuthToken,\n  RegisteredInstallationEntry\n} from '../interfaces/installation-entry';\nimport { PACKAGE_VERSION } from '../util/constants';\nimport {\n  extractAuthTokenInfoFromResponse,\n  getErrorFromResponse,\n  getHeadersWithAuth,\n  getInstallationsEndpoint,\n  retryIfServerError\n} from './common';\n\nexport async function generateAuthTokenRequest(\n  { appConfig, platformLoggerProvider }: FirebaseDependencies,\n  installationEntry: RegisteredInstallationEntry\n): Promise<CompletedAuthToken> {\n  const endpoint = getGenerateAuthTokenEndpoint(appConfig, installationEntry);\n\n  const headers = getHeadersWithAuth(appConfig, installationEntry);\n\n  // If platform logger exists, add the platform info string to the header.\n  const platformLogger = platformLoggerProvider.getImmediate({\n    optional: true\n  });\n  if (platformLogger) {\n    headers.append('x-firebase-client', platformLogger.getPlatformInfoString());\n  }\n\n  const body = {\n    installation: {\n      sdkVersion: PACKAGE_VERSION\n    }\n  };\n\n  const request: RequestInit = {\n    method: 'POST',\n    headers,\n    body: JSON.stringify(body)\n  };\n\n  const response = await retryIfServerError(() => fetch(endpoint, request));\n  if (response.ok) {\n    const responseValue: GenerateAuthTokenResponse = await response.json();\n    const completedAuthToken: CompletedAuthToken = extractAuthTokenInfoFromResponse(\n      responseValue\n    );\n    return completedAuthToken;\n  } else {\n    throw await getErrorFromResponse('Generate Auth Token', response);\n  }\n}\n\nfunction getGenerateAuthTokenEndpoint(\n  appConfig: AppConfig,\n  { fid }: RegisteredInstallationEntry\n): string {\n  return `${getInstallationsEndpoint(appConfig)}/${fid}/authTokens:generate`;\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { generateAuthTokenRequest } from '../api/generate-auth-token-request';\nimport { AppConfig } from '../interfaces/app-config';\nimport { FirebaseDependencies } from '../interfaces/firebase-dependencies';\nimport {\n  AuthToken,\n  CompletedAuthToken,\n  InProgressAuthToken,\n  InstallationEntry,\n  RegisteredInstallationEntry,\n  RequestStatus\n} from '../interfaces/installation-entry';\nimport { PENDING_TIMEOUT_MS, TOKEN_EXPIRATION_BUFFER } from '../util/constants';\nimport { ERROR_FACTORY, ErrorCode, isServerError } from '../util/errors';\nimport { sleep } from '../util/sleep';\nimport { remove, set, update } from './idb-manager';\n\n/**\n * Returns a valid authentication token for the installation. Generates a new\n * token if one doesn't exist, is expired or about to expire.\n *\n * Should only be called if the Firebase Installation is registered.\n */\nexport async function refreshAuthToken(\n  dependencies: FirebaseDependencies,\n  forceRefresh = false\n): Promise<CompletedAuthToken> {\n  let tokenPromise: Promise<CompletedAuthToken> | undefined;\n  const entry = await update(dependencies.appConfig, oldEntry => {\n    if (!isEntryRegistered(oldEntry)) {\n      throw ERROR_FACTORY.create(ErrorCode.NOT_REGISTERED);\n    }\n\n    const oldAuthToken = oldEntry.authToken;\n    if (!forceRefresh && isAuthTokenValid(oldAuthToken)) {\n      // There is a valid token in the DB.\n      return oldEntry;\n    } else if (oldAuthToken.requestStatus === RequestStatus.IN_PROGRESS) {\n      // There already is a token request in progress.\n      tokenPromise = waitUntilAuthTokenRequest(dependencies, forceRefresh);\n      return oldEntry;\n    } else {\n      // No token or token expired.\n      if (!navigator.onLine) {\n        throw ERROR_FACTORY.create(ErrorCode.APP_OFFLINE);\n      }\n\n      const inProgressEntry = makeAuthTokenRequestInProgressEntry(oldEntry);\n      tokenPromise = fetchAuthTokenFromServer(dependencies, inProgressEntry);\n      return inProgressEntry;\n    }\n  });\n\n  const authToken = tokenPromise\n    ? await tokenPromise\n    : (entry.authToken as CompletedAuthToken);\n  return authToken;\n}\n\n/**\n * Call only if FID is registered and Auth Token request is in progress.\n *\n * Waits until the current pending request finishes. If the request times out,\n * tries once in this thread as well.\n */\nasync function waitUntilAuthTokenRequest(\n  dependencies: FirebaseDependencies,\n  forceRefresh: boolean\n): Promise<CompletedAuthToken> {\n  // Unfortunately, there is no way of reliably observing when a value in\n  // IndexedDB changes (yet, see https://github.com/WICG/indexed-db-observers),\n  // so we need to poll.\n\n  let entry = await updateAuthTokenRequest(dependencies.appConfig);\n  while (entry.authToken.requestStatus === RequestStatus.IN_PROGRESS) {\n    // generateAuthToken still in progress.\n    await sleep(100);\n\n    entry = await updateAuthTokenRequest(dependencies.appConfig);\n  }\n\n  const authToken = entry.authToken;\n  if (authToken.requestStatus === RequestStatus.NOT_STARTED) {\n    // The request timed out or failed in a different call. Try again.\n    return refreshAuthToken(dependencies, forceRefresh);\n  } else {\n    return authToken;\n  }\n}\n\n/**\n * Called only if there is a GenerateAuthToken request in progress.\n *\n * Updates the InstallationEntry in the DB based on the status of the\n * GenerateAuthToken request.\n *\n * Returns the updated InstallationEntry.\n */\nfunction updateAuthTokenRequest(\n  appConfig: AppConfig\n): Promise<RegisteredInstallationEntry> {\n  return update(appConfig, oldEntry => {\n    if (!isEntryRegistered(oldEntry)) {\n      throw ERROR_FACTORY.create(ErrorCode.NOT_REGISTERED);\n    }\n\n    const oldAuthToken = oldEntry.authToken;\n    if (hasAuthTokenRequestTimedOut(oldAuthToken)) {\n      return {\n        ...oldEntry,\n        authToken: { requestStatus: RequestStatus.NOT_STARTED }\n      };\n    }\n\n    return oldEntry;\n  });\n}\n\nasync function fetchAuthTokenFromServer(\n  dependencies: FirebaseDependencies,\n  installationEntry: RegisteredInstallationEntry\n): Promise<CompletedAuthToken> {\n  try {\n    const authToken = await generateAuthTokenRequest(\n      dependencies,\n      installationEntry\n    );\n    const updatedInstallationEntry: RegisteredInstallationEntry = {\n      ...installationEntry,\n      authToken\n    };\n    await set(dependencies.appConfig, updatedInstallationEntry);\n    return authToken;\n  } catch (e) {\n    if (\n      isServerError(e) &&\n      (e.customData.serverCode === 401 || e.customData.serverCode === 404)\n    ) {\n      // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\n      // Generate a new ID next time.\n      await remove(dependencies.appConfig);\n    } else {\n      const updatedInstallationEntry: RegisteredInstallationEntry = {\n        ...installationEntry,\n        authToken: { requestStatus: RequestStatus.NOT_STARTED }\n      };\n      await set(dependencies.appConfig, updatedInstallationEntry);\n    }\n    throw e;\n  }\n}\n\nfunction isEntryRegistered(\n  installationEntry: InstallationEntry | undefined\n): installationEntry is RegisteredInstallationEntry {\n  return (\n    installationEntry !== undefined &&\n    installationEntry.registrationStatus === RequestStatus.COMPLETED\n  );\n}\n\nfunction isAuthTokenValid(authToken: AuthToken): boolean {\n  return (\n    authToken.requestStatus === RequestStatus.COMPLETED &&\n    !isAuthTokenExpired(authToken)\n  );\n}\n\nfunction isAuthTokenExpired(authToken: CompletedAuthToken): boolean {\n  const now = Date.now();\n  return (\n    now < authToken.creationTime ||\n    authToken.creationTime + authToken.expiresIn < now + TOKEN_EXPIRATION_BUFFER\n  );\n}\n\n/** Returns an updated InstallationEntry with an InProgressAuthToken. */\nfunction makeAuthTokenRequestInProgressEntry(\n  oldEntry: RegisteredInstallationEntry\n): RegisteredInstallationEntry {\n  const inProgressAuthToken: InProgressAuthToken = {\n    requestStatus: RequestStatus.IN_PROGRESS,\n    requestTime: Date.now()\n  };\n  return {\n    ...oldEntry,\n    authToken: inProgressAuthToken\n  };\n}\n\nfunction hasAuthTokenRequestTimedOut(authToken: AuthToken): boolean {\n  return (\n    authToken.requestStatus === RequestStatus.IN_PROGRESS &&\n    authToken.requestTime + PENDING_TIMEOUT_MS < Date.now()\n  );\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { getInstallationEntry } from '../helpers/get-installation-entry';\nimport { refreshAuthToken } from '../helpers/refresh-auth-token';\nimport { FirebaseDependencies } from '../interfaces/firebase-dependencies';\n\nexport async function getId(\n  dependencies: FirebaseDependencies\n): Promise<string> {\n  const { installationEntry, registrationPromise } = await getInstallationEntry(\n    dependencies.appConfig\n  );\n\n  if (registrationPromise) {\n    registrationPromise.catch(console.error);\n  } else {\n    // If the installation is already registered, update the authentication\n    // token if needed.\n    refreshAuthToken(dependencies).catch(console.error);\n  }\n\n  return installationEntry.fid;\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { getInstallationEntry } from '../helpers/get-installation-entry';\nimport { refreshAuthToken } from '../helpers/refresh-auth-token';\nimport { AppConfig } from '../interfaces/app-config';\nimport { FirebaseDependencies } from '../interfaces/firebase-dependencies';\n\nexport async function getToken(\n  dependencies: FirebaseDependencies,\n  forceRefresh = false\n): Promise<string> {\n  await completeInstallationRegistration(dependencies.appConfig);\n\n  // At this point we either have a Registered Installation in the DB, or we've\n  // already thrown an error.\n  const authToken = await refreshAuthToken(dependencies, forceRefresh);\n  return authToken.token;\n}\n\nasync function completeInstallationRegistration(\n  appConfig: AppConfig\n): Promise<void> {\n  const { registrationPromise } = await getInstallationEntry(appConfig);\n\n  if (registrationPromise) {\n    // A createInstallation request is in progress. Wait until it finishes.\n    await registrationPromise;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AppConfig } from '../interfaces/app-config';\nimport { RegisteredInstallationEntry } from '../interfaces/installation-entry';\nimport {\n  getErrorFromResponse,\n  getHeadersWithAuth,\n  getInstallationsEndpoint,\n  retryIfServerError\n} from './common';\n\nexport async function deleteInstallationRequest(\n  appConfig: AppConfig,\n  installationEntry: RegisteredInstallationEntry\n): Promise<void> {\n  const endpoint = getDeleteEndpoint(appConfig, installationEntry);\n\n  const headers = getHeadersWithAuth(appConfig, installationEntry);\n  const request: RequestInit = {\n    method: 'DELETE',\n    headers\n  };\n\n  const response = await retryIfServerError(() => fetch(endpoint, request));\n  if (!response.ok) {\n    throw await getErrorFromResponse('Delete Installation', response);\n  }\n}\n\nfunction getDeleteEndpoint(\n  appConfig: AppConfig,\n  { fid }: RegisteredInstallationEntry\n): string {\n  return `${getInstallationsEndpoint(appConfig)}/${fid}`;\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { deleteInstallationRequest } from '../api/delete-installation-request';\nimport { remove, update } from '../helpers/idb-manager';\nimport { FirebaseDependencies } from '../interfaces/firebase-dependencies';\nimport { RequestStatus } from '../interfaces/installation-entry';\nimport { ERROR_FACTORY, ErrorCode } from '../util/errors';\n\nexport async function deleteInstallation(\n  dependencies: FirebaseDependencies\n): Promise<void> {\n  const { appConfig } = dependencies;\n\n  const entry = await update(appConfig, oldEntry => {\n    if (oldEntry && oldEntry.registrationStatus === RequestStatus.NOT_STARTED) {\n      // Delete the unregistered entry without sending a deleteInstallation request.\n      return undefined;\n    }\n    return oldEntry;\n  });\n\n  if (entry) {\n    if (entry.registrationStatus === RequestStatus.IN_PROGRESS) {\n      // Can't delete while trying to register.\n      throw ERROR_FACTORY.create(ErrorCode.DELETE_PENDING_REGISTRATION);\n    } else if (entry.registrationStatus === RequestStatus.COMPLETED) {\n      if (!navigator.onLine) {\n        throw ERROR_FACTORY.create(ErrorCode.APP_OFFLINE);\n      } else {\n        await deleteInstallationRequest(appConfig, entry);\n        await remove(appConfig);\n      }\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { addCallback, removeCallback } from '../helpers/fid-changed';\nimport { FirebaseDependencies } from '../interfaces/firebase-dependencies';\n\nexport type IdChangeCallbackFn = (installationId: string) => void;\nexport type IdChangeUnsubscribeFn = () => void;\n\n/**\n * Sets a new callback that will get called when Installation ID changes.\n * Returns an unsubscribe function that will remove the callback when called.\n */\nexport function onIdChange(\n  { appConfig }: FirebaseDependencies,\n  callback: IdChangeCallbackFn\n): IdChangeUnsubscribeFn {\n  addCallback(appConfig, callback);\n\n  return () => {\n    removeCallback(appConfig, callback);\n  };\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FirebaseApp, FirebaseOptions } from '@firebase/app-types';\nimport { FirebaseError } from '@firebase/util';\nimport { AppConfig } from '../interfaces/app-config';\nimport { ERROR_FACTORY, ErrorCode } from '../util/errors';\n\nexport function extractAppConfig(app: FirebaseApp): AppConfig {\n  if (!app || !app.options) {\n    throw getMissingValueError('App Configuration');\n  }\n\n  if (!app.name) {\n    throw getMissingValueError('App Name');\n  }\n\n  // Required app config keys\n  const configKeys: Array<keyof FirebaseOptions> = [\n    'projectId',\n    'apiKey',\n    'appId'\n  ];\n\n  for (const keyName of configKeys) {\n    if (!app.options[keyName]) {\n      throw getMissingValueError(keyName);\n    }\n  }\n\n  return {\n    appName: app.name,\n    projectId: app.options.projectId!,\n    apiKey: app.options.apiKey!,\n    appId: app.options.appId!\n  };\n}\n\nfunction getMissingValueError(valueName: string): FirebaseError {\n  return ERROR_FACTORY.create(ErrorCode.MISSING_APP_CONFIG_VALUES, {\n    valueName\n  });\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport firebase from '@firebase/app';\nimport {\n  _FirebaseNamespace,\n  FirebaseService\n} from '@firebase/app-types/private';\nimport { Component, ComponentType } from '@firebase/component';\nimport { FirebaseInstallations } from '@firebase/installations-types';\nimport {\n  deleteInstallation,\n  getId,\n  getToken,\n  IdChangeCallbackFn,\n  IdChangeUnsubscribeFn,\n  onIdChange\n} from './functions';\nimport { extractAppConfig } from './helpers/extract-app-config';\nimport { FirebaseDependencies } from './interfaces/firebase-dependencies';\n\nimport { name, version } from '../package.json';\n\nexport function registerInstallations(instance: _FirebaseNamespace): void {\n  const installationsName = 'installations';\n\n  instance.INTERNAL.registerComponent(\n    new Component(\n      installationsName,\n      container => {\n        const app = container.getProvider('app').getImmediate();\n\n        // Throws if app isn't configured properly.\n        const appConfig = extractAppConfig(app);\n        const platformLoggerProvider = container.getProvider('platform-logger');\n        const dependencies: FirebaseDependencies = {\n          appConfig,\n          platformLoggerProvider\n        };\n\n        const installations: FirebaseInstallations & FirebaseService = {\n          app,\n          getId: () => getId(dependencies),\n          getToken: (forceRefresh?: boolean) =>\n            getToken(dependencies, forceRefresh),\n          delete: () => deleteInstallation(dependencies),\n          onIdChange: (callback: IdChangeCallbackFn): IdChangeUnsubscribeFn =>\n            onIdChange(dependencies, callback)\n        };\n        return installations;\n      },\n      ComponentType.PUBLIC\n    )\n  );\n\n  instance.registerVersion(name, version);\n}\n\nregisterInstallations(firebase as _FirebaseNamespace);\n\n/**\n * Define extension behavior of `registerInstallations`\n */\ndeclare module '@firebase/app-types' {\n  interface FirebaseNamespace {\n    installations(app?: FirebaseApp): FirebaseInstallations;\n  }\n  interface FirebaseApp {\n    installations(): FirebaseInstallations;\n  }\n}\n","(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n  typeof define === 'function' && define.amd ? define(['exports'], factory) :\n  (global = global || self, factory(global.idb = {}));\n}(this, function (exports) { 'use strict';\n\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        },\n        set: function(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      // Don't create iterateKeyCursor if openKeyCursor doesn't exist.\n      if (!(funcName in Constructor.prototype)) return;\n\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  function openDb(name, version, upgradeCallback) {\n    var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n    var request = p.request;\n\n    if (request) {\n      request.onupgradeneeded = function(event) {\n        if (upgradeCallback) {\n          upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n        }\n      };\n    }\n\n    return p.then(function(db) {\n      return new DB(db);\n    });\n  }\n\n  function deleteDb(name) {\n    return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n  }\n\n  exports.openDb = openDb;\n  exports.deleteDb = deleteDb;\n\n  Object.defineProperty(exports, '__esModule', { value: true });\n\n}));\n"]},"banner":"For license information please see 0.f58b5666.chunk.js.LICENSE.txt","extractedComments":"/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n","commentsFilename":"static/js/0.f58b5666.chunk.js.LICENSE.txt"}